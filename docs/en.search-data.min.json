[{"id":0,"href":"/5.Timer/","title":"5.Timer","parent":"ç®€ä»‹","content":"Timer    Timer ç±»è´Ÿè´£è®¡åˆ’ä»»åŠ¡\nå¯ä»¥ä½¿ç”¨æŠ½è±¡ç±» TimerTaskçš„å­ç±»è¿›è¡Œä¸šåŠ¡ç¼–å†™ã€‚\nSchedule(TimerTask task, Date date)     è®¾ç½®å®šæ—¶ä»»åŠ¡ Run.java\npublic class Run { public static Timer timer = new Timer(); public static class MyTask extends TimerTask{ @Override public void run() { System.out.println(\u0026#34;å®šæ—¶ä»»åŠ¡æ—¶é—´åˆ°\u0026#34;); } } public static void main(String[] args) { try{ MyTask task = new MyTask(); SimpleDateFormat sdf = new SimpleDateFormat(\u0026#34;yyyy-MM-dd HH:mm:ss\u0026#34;); Date date = sdf.parse(\u0026#34;2021-09-30 09:14:00\u0026#34;); timer.schedule(task, date); }catch (ParseException e){ } } } è¿è¡Œç»“æœï¼šåœ¨è®¾å®šçš„æ—¶é—´æ‰“å°äº†â€œå®šæ—¶ä»»åŠ¡æ—¶é—´åˆ°â€ã€‚\nå…¶ä¸­ timer æ–°å¯åŠ¨äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸»çº¿ç¨‹ç»“æŸæ—¶ï¼Œå­çº¿ç¨‹ä»ç„¶ç»§ç»­è¿è¡Œã€‚ä¸ºäº†ä½¿å¾—å­ç¨‹åºä¼´éšä¸»ç¨‹åºçš„ç»“æŸè€Œç»“æŸï¼Œå¯ä»¥å°†å­çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ğŸ‘‡\n public static Timer timer = new Timer(true);\n  å½“ä»»åŠ¡ task æœ‰å¤šä¸ªçš„æ—¶å€™ï¼Œå®ƒä»¬æ˜¯æŒ‰ç…§ä¸ schedule çš„ç»‘å®šé¡ºåºæ¥è¿›å…¥è®¡åˆ’é˜Ÿåˆ—çš„ã€‚ import java.text.ParseException; import java.text.SimpleDateFormat; import java.util.Date; import java.util.Timer; import java.util.TimerTask; public class Run { public static Timer timer = new Timer(); public static class MyTask extends TimerTask{ @Override public void run() { System.out.println(\u0026#34;å®šæ—¶ä»»åŠ¡1æ—¶é—´åˆ° \u0026#34; + System.currentTimeMillis()); try { Thread.sleep(6000); } catch (InterruptedException e) { e.printStackTrace(); } } } public static class MyTask2 extends TimerTask{ @Override public void run() { System.out.println(\u0026#34;å®šæ—¶ä»»åŠ¡2æ—¶é—´åˆ° \u0026#34; + System.currentTimeMillis()); } } public static void main(String[] args) { try{ MyTask task = new MyTask(); MyTask2 task2 = new MyTask2(); SimpleDateFormat sdf = new SimpleDateFormat(\u0026#34;yyyy-MM-dd HH:mm:ss\u0026#34;); Date date = sdf.parse(\u0026#34;2021-09-30 09:37:00\u0026#34;); Date date2 = sdf.parse(\u0026#34;2021-09-30 09:37:05\u0026#34;); timer.schedule(task, date); timer.schedule(task2, date2); }catch (ParseException e){ } } } è¿è¡Œç»“æœ\n å®šæ—¶ä»»åŠ¡1æ—¶é—´åˆ° 1632966052416\nå®šæ—¶ä»»åŠ¡2æ—¶é—´åˆ° 1632966058433\n å…¶ä¸­ï¼Œä»»åŠ¡ 1 æ‰§è¡Œè€—æ—¶ 6000msï¼Œä»»åŠ¡çš„ä¼˜å…ˆçº§åˆ«æ˜¯ä»¥åŠ å…¥ schedule çš„æ—©æ™šä¸ºæ ‡å‡†çš„ï¼ˆtask åŠ å…¥ schedule é˜Ÿåˆ—ï¼‰ï¼Œè€Œ timer æ˜¯å•ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ä»»åŠ¡ 2 éœ€è¦ç­‰å¾…ä»»åŠ¡ 1 æ‰§è¡Œå®Œæ¯•æ‰å¼€å§‹åˆ¤æ–­ä¸Šä¸€æ¬¡ä»»åŠ¡çš„å¼€å§‹æ—¶é—´ä¸å½“å‰ä»»åŠ¡è®¾å®šçš„æ—¶é—´ä¹‹é—´çš„å…³ç³»ï¼Œè®¾å®šæ—¶é—´å·²åˆ°æˆ–è€…è¿‡æœŸå°±æ‰§è¡Œï¼Œè®¾å®šæ—¶é—´æœªåˆ°å°±ç­‰å¾…ã€‚\n schedule(TimerTask task, Date time, long period)    ã€å®šæ—¶å¾ªç¯ä»»åŠ¡ã€\nä¸€æ—¦æ—¶é—´åˆ°è¾¾ timeï¼Œåˆ™æŒ‰ç…§ period é—´éš”å¾ªç¯æ‰§è¡Œ taskã€‚\n timer.schedule(task,time,period);\n ã€cancelã€\n  task.cancel() å–æ¶ˆä»»åŠ¡æœ¬èº«ã€‚\n  timer.cancel() å–æ¶ˆ timer æ‰€ç»‘å®šçš„æ‰€æœ‰ä»»åŠ¡ï¼Œå¹¶ä¸” timer çº¿ç¨‹ç»“æŸã€‚\næœ‰æ—¶ cancel æ–¹æ³•æ²¡æœ‰æŠ¢åˆ° queue é”ï¼Œåˆ™å®šæ—¶å™¨å–æ¶ˆä¸æˆåŠŸï¼Œå„ä¸ªä»»åŠ¡ç…§å¸¸æ‰§è¡Œã€‚\n  schedule(TimerTask task, long delay)    ä»¥å½“å‰ç³»ç»Ÿæ—¶é—´ä¸ºåŸºå‡†ï¼Œå»¶æ—¶ delay æ—¶é—´æ‰§è¡Œ taskã€‚\nschedule(TimerTask task, long delayï¼Œlong period)    ä»¥å½“å‰ç³»ç»Ÿæ—¶é—´ä¸ºåŸºå‡†ï¼Œå»¶æ—¶ delay æ—¶é—´æ‰§è¡Œ taskï¼Œä¸”å¾€åæ¯éš” period çš„æ—¶é—´é—´éš”éƒ½ä¼šæ‰§è¡Œ taskã€‚\nschedule ä¸ scheduleAtFixedRate çš„åŒºåˆ«     schedule å½“å‰ä»»åŠ¡æ—¶é—´æ˜¯å¦æŠµè¾¾æ˜¯ä»¥ä¸Šä¸€æ¬¡ä»»åŠ¡çš„å¼€å§‹æ—¶é—´ä¸ºåŸºå‡†ã€‚ scheduleAtFixedRate å½“å‰ä»»åŠ¡æ—¶é—´æ˜¯å¦æŠµè¾¾æ˜¯ä»¥ä¸Šä¸€æ¬¡ä»»åŠ¡çš„ç»“æŸæ—¶é—´ä¸ºåŸºå‡†ã€‚  "},{"id":1,"href":"/4.Lock/4.2ReentrantReadWriteLock/","title":"4.2 ReentrantReadWriteLock","parent":"4.Lock","content":"è¯»å†™é”åŒ…æ‹¬å…±äº«é”ï¼ˆè¯»ï¼‰ã€æ’ä»–é”ï¼ˆå†™ï¼‰ã€‚\næ²¡æœ‰çº¿ç¨‹è¿›è¡Œå†™å…¥æ“ä½œæ—¶ï¼Œå¤šä¸ªè¯»å–çº¿ç¨‹éƒ½å¯ä»¥è·å¾—é”ï¼Œè€Œè¿›è¡Œå†™å…¥æ“ä½œçš„çº¿ç¨‹åªæœ‰è·å¾—å†™å…¥é”æ‰èƒ½å†™å…¥ã€‚\n è¯»è¯»å…±äº« å†™å†™äº’æ–¥ è¯»å†™äº’æ–¥ å†™è¯»äº’æ–¥  è¯»è¯»å…±äº«     Service.java import java.util.concurrent.locks.ReentrantReadWriteLock; public class Service { private ReentrantReadWriteLock lock; public Service(ReentrantReadWriteLock lock){ this.lock = lock; } public void read(){ lock.readLock().lock(); System.out.println(Thread.currentThread().getName() + \u0026#34; \u0026#34; +System.currentTimeMillis()); lock.readLock().unlock(); } }   ThreadA.java public class ThreadA extends Thread{ private Service service; public ThreadA(Service service){ this.service = service; } @Override public void run(){ service.read(); } }   ThreadB.java public class ThreadB extends Thread{ private Service service; public ThreadB(Service service){ this.service = service; } @Override public void run(){ service.read(); } }   Run.java import java.util.concurrent.locks.ReentrantReadWriteLock; public class Run { public static void main(String[] args) { ReentrantReadWriteLock lock = new ReentrantReadWriteLock(); Service service = new Service(lock); ThreadA A = new ThreadA(service); ThreadB B = new ThreadB(service); A.start(); B.start(); } }  æ‰§è¡Œç»“æœ\n Thread-0 1632923125926\nThread-1 1632923125926\n ä¸¤ä¸ªçº¿ç¨‹æ‰“å°çš„é—´éš”æ—¶é—´å¾ˆçŸ­ï¼Œå‡ ä¹åŒæ—¶è®¿é—®å…±äº«é”é”ä½çš„å†…å®¹ï¼Œè¿™æ ·çš„å…±äº«é”å¯ä»¥æé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚\nå†™å†™äº’æ–¥    æŠŠè¯»é”æ¢æˆå†™é” lock.writeLock.lock()ï¼Œåˆ™ A Bä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œ service.read() è¿›è¡Œçš„æ˜¯å†™é”ï¼ˆæ’ä»–é”ï¼‰ã€‚\nè¿è¡Œç»“æœï¼š\n Thread-0 1632923636440\nThread-1 1632923636451\n å¯ä»¥å‘ç°ä¸¤ä¸ªçº¿ç¨‹æ‰“å°çš„é—´éš”è¾ƒé•¿ï¼ˆå•ä½æ¯«ç§’ï¼‰ã€‚\nè¯»å†™äº’æ–¥     Service.java import java.util.concurrent.locks.ReentrantReadWriteLock; public class Service { private ReentrantReadWriteLock lock; public Service(ReentrantReadWriteLock lock){ this.lock = lock; } public void read(){ try{ lock.readLock().lock(); System.out.println(\u0026#34;read:\u0026#34; + Thread.currentThread().getName() + \u0026#34; \u0026#34; +System.currentTimeMillis()); Thread.sleep(3000); }catch (InterruptedException e){ }finally { lock.readLock().unlock(); } } public void write(){ try { lock.writeLock().lock(); System.out.println(\u0026#34;write:\u0026#34;+ Thread.currentThread().getName() + \u0026#34; \u0026#34; +System.currentTimeMillis()); Thread.sleep(3000); }catch (InterruptedException e){ }finally { lock.writeLock().unlock(); } } }   ThreadA.java public class ThreadA extends Thread{ private Service service; public ThreadA(Service service){ this.service = service; } @Override public void run(){ service.read(); } }   ThreadB.java public class ThreadB extends Thread{ private Service service; public ThreadB(Service service){ this.service = service; } @Override public void run(){ service.write(); } }   Run.java public class Run { public static void main(String[] args) throws InterruptedException { ReentrantReadWriteLock lock = new ReentrantReadWriteLock(); Service service = new Service(lock); ThreadA A = new ThreadA(service); ThreadB B = new ThreadB(service); A.start(); Thread.sleep(1000); B.start(); } }  è¿è¡Œç»“æœï¼š\n read:Thread-0 1632924236688\nwrite:Thread-1 1632924239709\n çº¿ç¨‹ A åœ¨è¯»å–æ—¶ï¼Œçº¿ç¨‹ B æƒ³è¦å†™å…¥ï¼ŒäºŒè€…ä¹‹é—´æ˜¯äº’æ–¥çš„ã€‚\nå†™è¯»äº’æ–¥    å°† Run.java ä¸­çš„ çº¿ç¨‹ A å’Œçº¿ç¨‹ B çš„æ‰§è¡Œé¡ºåºé¢ å€’ï¼Œä¹Ÿä¼šäº§ç”Ÿäº’æ–¥ã€‚\n A.start();\nThread.sleep(1000);\nB.start();\n "},{"id":2,"href":"/4.Lock/","title":"4.Lock","parent":"ç®€ä»‹","content":"å¯é‡å…¥é”     ReentrantLock ä¸ Condition é…åˆå®ç°äº’æ–¥åŒæ­¥ã€‚ await/signal ç­‰å¾…é€šçŸ¥æ¨¡å¼ ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼  å¤šä¸ªæ¶ˆè´¹è€…å¤šä¸ªç”Ÿäº§è€…ï¼šä¸€ä¸ªç”Ÿäº§è€…é€šçŸ¥æ‰€æœ‰æ¶ˆè´¹è€…ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…é€šçŸ¥æ‰€æœ‰ç”Ÿäº§è€…ã€‚ã€signalAll()ã€ ä¸€ä¸ªç”Ÿäº§è€…ä¸€ä¸ªæ¶ˆè´¹è€…ï¼šä¸€ä¸ªç”Ÿäº§è€…é€šçŸ¥ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…é€šçŸ¥ä¸€ä¸ªç”Ÿäº§è€…ã€‚ã€signal()ã€    "},{"id":3,"href":"/4.Lock/4.1ReentrantLock/","title":"4.1ReentrantLock","parent":"4.Lock","content":"ReentrantLock å¯é‡å…¥é”\n å—…æ¢é”å®š å¤šè·¯åˆ†æ”¯é€šçŸ¥  1. å®ç°åŒæ­¥åŠŸèƒ½     å®ç°äº’æ–¥   MyService.java import java.util.concurrent.locks.Lock; import java.util.concurrent.locks.ReentrantLock; public class MyService { private Lock lock = new ReentrantLock(); public void service(){ lock.lock(); System.out.println(Thread.currentThread().getName()); for (int i = 0; i \u0026lt; 20; i++) { System.out.print(i); } System.out.println(); lock.unlock(); } }   MyThread.java public class MyThread extends Thread{ MyService service; public MyThread(MyService service){ this.service = service; } @Override public void run(){ service.service(); } }   Run.java public class Run { public static void main(String[] args) { MyService s = new MyService(); for (int i = 0; i \u0026lt; 5; i++) { MyThread t = new MyThread(s); t.setName(\u0026#34;Thread\u0026#34; + i); t.start(); } } }  è¿è¡Œç»“æœ\n2. wait/notify çš„å®ç°    synchronized ä¸ wait() å’Œ notity()/notifyAll()æ–¹æ³•çš„ç»“åˆå¯ä»¥å®ç°ã€ç­‰å¾…/é€šçŸ¥ã€æ¨¡å¼ã€‚\nReentrantLock ä¸ Condition ä¹Ÿå¯å®ç°åŒæ ·çš„åŠŸèƒ½ã€‚\nåœ¨ä¸€ä¸ª Lock å¯¹è±¡ä¸­å¯ä»¥åˆ›å»ºå¤šä¸ª Condition å¯¹è±¡ã€‚çº¿ç¨‹å¯¹è±¡å¯ä»¥æ³¨å†Œåœ¨æŒ‡å®šçš„ Condition ä¸­ï¼Œå®ç°æœ‰é€‰æ‹©æ€§çš„çº¿ç¨‹é€šçŸ¥ã€‚\nè°ƒç”¨ condition.await() ä¹‹å‰éœ€è¦å…ˆè·å–é”ã€‚\nçº¿ç¨‹è¢« await() æŒ‚èµ·ä¹‹åï¼Œinterrupt() ä¹Ÿä¼šå¼•èµ· InterruptedException.\nawait(long time, TimeUnit unit) å¯ä»¥è®¾å®šæŒ‚èµ·æ—¶é—´ã€‚\nReentrantLock ä¸ condition    ReentrantLock çš„ await ä¸ condition çš„ signal\n MyService.java import java.util.concurrent.locks.Condition; import java.util.concurrent.locks.Lock; import java.util.concurrent.locks.ReentrantLock; public class MyService { private Lock lock = new ReentrantLock(); private Condition condition = lock.newCondition(); public void await(){ try{ lock.lock();//éœ€è¦å…ˆè·å–é”  System.out.println(\u0026#34;Ready\u0026#34;); condition.await(); System.out.println(Thread.currentThread().getName()); }catch (InterruptedException e){ e.printStackTrace(); }finally { lock.unlock(); } } public void signal(){ lock.lock(); condition.signal(); lock.unlock(); } }   MyThread.java public class MyThread extends Thread{ MyService service; public MyThread(MyService service){ this.service = service; } @Override public void run(){ service.await(); } }   Run.java public class Run { public static void main(String[] args) throws InterruptedException { MyService s = new MyService(); MyThread t = new MyThread(s); t.setName(\u0026#34;Ha\u0026#34;); t.start(); Thread.sleep(1000); s.signal(); } }  è¿è¡Œç»“æœ\n Ready\nHa\n å…ˆæ˜¾ç¤º Readyï¼Œç­‰å¾… 1 ç§’ä¹‹åæŒ‚èµ·çš„çº¿ç¨‹è¢«é€šçŸ¥ï¼Œæ‰“å° Haã€‚\nå¤šä¸ª Condition é€šçŸ¥éƒ¨åˆ†çº¿ç¨‹     MyService.java import java.util.concurrent.locks.Condition; import java.util.concurrent.locks.ReentrantLock; public class MyService { private ReentrantLock lock = new ReentrantLock(); private Condition conditionA = lock.newCondition();// Object monitor  private Condition conditionB = lock.newCondition();// Object monitor  public void awaitA(){ try { lock.lock(); System.out.println(\u0026#34;A start\u0026#34;); conditionA.await(); System.out.println(\u0026#34;A end\u0026#34;); }catch (InterruptedException e){ }finally { lock.unlock(); } } public void awaitB(){ try{ lock.lock(); System.out.println(\u0026#34;B start\u0026#34;); conditionB.await(); System.out.println(\u0026#34;B end\u0026#34;); }catch (InterruptedException e){ }finally{ lock.unlock(); } } public void signalA(){ lock.lock(); conditionA.signal(); lock.unlock(); } public void signalB(){ lock.lock(); conditionB.signal(); lock.unlock(); } }   ThreadA.java public class ThreadA extends Thread{ MyService service; public ThreadA(MyService service){ this.service = service; } @Override public void run(){ service.awaitA(); } }   ThreadB.java public class ThreadB extends Thread{ MyService service; public ThreadB(MyService service){ this.service = service; } @Override public void run(){ service.awaitB(); } }   Run.java public class Run { public static void main(String[] args) throws InterruptedException { MyService s = new MyService(); ThreadA A = new ThreadA(s); ThreadB B = new ThreadB(s); A.start();//çº¿ç¨‹ A å°†ä¼šè¢« ConditionA æŒ‚èµ·  B.start();//çº¿ç¨‹ B å°†ä¼šè¢« ConditionB æŒ‚èµ·  Thread.sleep(1000); s.signalA(); Thread.sleep(1000); s.signalB(); } }  è¿è¡Œç»“æœ\n A start\nB start\nA end\nB end\n 3. ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼    ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ä¸‹ï¼Œäº§å“ç”Ÿäº§ä¸€ä¸ªä¾¿å¯æ¶ˆè´¹ä¸€ä¸ªã€‚å½“çº¿ç¨‹ä¸€å¯¹ä¸€çš„æ—¶å€™ï¼Œæ¯æ¬¡ç”Ÿäº§æ¶ˆè´¹éƒ½æ˜¯ç”±è¿™ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œçš„ã€‚å½“çº¿ç¨‹å¤šå¯¹å¤šçš„æ—¶å€™ï¼Œæ¯æ¬¡ç”Ÿäº§æ¶ˆè´¹çš„æ‰§è¡Œä¸ä¼šæ˜¯ç”±ç‰¹å®šçš„ä¸¤ä¸ªçº¿ç¨‹æ‰¿åŒ…ï¼Œè€Œæ˜¯å„ä¸ªçº¿ç¨‹éƒ½æœ‰æœºä¼šæ¥å±¥è¡ŒèŒè´£ã€‚æ¯”å¦‚ P1ã€P2ã€C1ã€C2ï¼ŒP1 ç”Ÿäº§çš„äº§å“ï¼Œå¯ç”± C1 æˆ– C2æ¥æ¶ˆè´¹ï¼›è€Œ C1 æ¶ˆè´¹çš„äº§å“ï¼Œå¯èƒ½æ¥è‡ª P1 æˆ–è€… P2ã€‚\ncondition ä½œä¸ºçº¿ç¨‹ç›‘è§†å™¨ï¼Œå¯ä»¥ç»‘å®šå¤šä¸ªçº¿ç¨‹ã€‚\nä»¥ä¸‹ä»£ç ä¸­ï¼ŒconditionP ç»‘å®šçš„æ˜¯ThreadPï¼Œ conditionC ç»‘å®šçš„æ˜¯ ThreadCã€‚\n conditionP.signal() éšæœºé€šçŸ¥ä¸€ä¸ªThreadPï¼ŒconditionC.signal() éšæœºé€šçŸ¥ä¸€ä¸ªThreadCã€‚ conditionP.signalAll() é€šçŸ¥çš„æ˜¯æ‰€æœ‰ThreadPï¼ŒconditionC.signalAll() é€šçŸ¥çš„æ˜¯æ‰€æœ‰ThreadCã€‚  å¤šç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…ï¼Œè‹¥ä½¿ç”¨ä¸¤ä¸ª Condition å’Œ signalAll()    å¤šç”Ÿäº§è€…å’Œå¤šæ¶ˆè´¹è€…ä¸­ï¼Œç”Ÿäº§ä¸€ä¸ªæ¶ˆè´¹ä¸€ä¸ªã€‚é€šçŸ¥å±äºåŒä¸€ä¸ª Condition çš„æ‰€æœ‰ã€‚\nå½“ç”Ÿäº§è€…ç”Ÿäº§äº†äº§å“ä¹‹åï¼Œä¼šé€šçŸ¥æ‰€æœ‰çš„æ¶ˆè´¹è€…ã€‚åŠ¨ä½œè¾ƒå¿«çš„æ¶ˆè´¹è€…å°±å¯ä»¥æ¶ˆè´¹äº§å“ï¼Œå‰©ä¸‹çš„æ¶ˆè´¹è€…ç”±äºæ²¡æœ‰äº§å“å¯æ¶ˆè´¹è€Œç»§ç»­ç­‰å¾…ã€‚\nåŒæ ·çš„ï¼Œå½“æ¶ˆè´¹è€…æ¶ˆè´¹äº§å“ä¹‹åä¼šé€šçŸ¥æ‰€æœ‰ç”Ÿäº§è€…ã€‚åŠ¨ä½œè¾ƒå¿«çš„ç”Ÿäº§è€…å¯ä»¥ç”Ÿäº§äº§å“ï¼Œå‰©ä¸‹çš„ç”Ÿäº§è€…ç”±äºä¸éœ€è¦ç”Ÿäº§è€Œç»§ç»­ç­‰å¾…ã€‚\n P.java import java.util.concurrent.locks.Condition; import java.util.concurrent.locks.ReentrantLock; public class P { private ReentrantLock lock; public Condition conditionP; public Condition conditionC; public P(ReentrantLock lock){ this.lock = lock; this.conditionP = lock.newCondition(); } public void produce(){ try{ lock.lock(); while (!Value.str.equals(\u0026#34;\u0026#34;)){ System.out.println(Thread.currentThread().getName() + \u0026#34; await\u0026#34;); conditionP.await(); System.out.println(Thread.currentThread().getName() + \u0026#34; resume\u0026#34;); } Value.str = new String(\u0026#34;Fine\u0026#34; + Value.i++); System.out.println(Thread.currentThread().getName() + \u0026#34; running\u0026#34;); conditionC.signalAll();//awake all threads that bind to conditionC  lock.unlock(); }catch(InterruptedException e){ } } public void connect(C c){ this.conditionC = c.conditionC; } }   C.java import java.util.concurrent.locks.Condition; import java.util.concurrent.locks.ReentrantLock; public class C { private ReentrantLock lock; public Condition conditionC; public Condition conditionP; public C(ReentrantLock lock){ this.lock = lock; this.conditionC = lock.newCondition(); } public void consume(){ try{ lock.lock(); while (Value.str.equals(\u0026#34;\u0026#34;)){ System.out.println(Thread.currentThread().getName() + \u0026#34; await\u0026#34;); conditionC.await(); System.out.println(Thread.currentThread().getName() + \u0026#34; resume\u0026#34;); } System.out.println(Thread.currentThread().getName() + \u0026#34; consume \u0026#34; + Value.str); Value.str = new String(\u0026#34;\u0026#34;); conditionP.signalAll();//awake all threads that bind to conditionP  lock.unlock(); }catch (InterruptedException e){ } } public void connect(P p){ this.conditionP = p.conditionP; } }   ThreadP.java public class ThreadP extends Thread{ private P p; public ThreadP (P p){ this.p = p; } @Override public void run() { for (int i = 0; i \u0026lt; 50; i++) { p.produce(); } } }   ThreadC.java public class ThreadC extends Thread{ private C c; public ThreadC(C c){ this.c = c; } @Override public void run(){ for (int i = 0; i \u0026lt; 50; i++) { c.consume(); } } }   Value.java public class Value { public static String str = \u0026#34;\u0026#34;; public static int i = 0; }   Run.java import java.util.concurrent.locks.ReentrantLock; public class Run { public static void main(String[] args) { ReentrantLock lock = new ReentrantLock(); P p = new P(lock); C c = new C(lock); p.connect(c); c.connect(p); ThreadC[] consumer = new ThreadC[2]; ThreadP[] producer = new ThreadP[2]; for (int i = 0; i \u0026lt; 2; i++) { consumer[i] = new ThreadC(c); producer[i] = new ThreadP(p); consumer[i].setName(\u0026#34;consumer\u0026#34;+i); producer[i].setName(\u0026#34;producer\u0026#34;+i); consumer[i].start(); producer[i].start(); } } }  è¿è¡Œç»“æœï¼šå¤šç”Ÿäº§è€…ä¸å¤šæ¶ˆè´¹è€…äº¤æ›¿æ‰“å°ã€‚ç”Ÿäº§ä¸€ä¸ªæ‰“å°ä¸€ä¸ªã€‚ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹å­˜åœ¨ã€æœ‰è¢«å”¤é†’ï¼Œä½†å› ä¸ºæ²¡æœ‰äº§å“å¯æ“ä½œè€Œå†æ¬¡è¿›å…¥ç­‰å¾…ã€çš„æƒ…å†µã€‚\nå¤šç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…ï¼Œè‹¥ä½¿ç”¨ä¸¤ä¸ª Condition å’Œ signal()    å¤šç”Ÿäº§è€…å’Œå¤šæ¶ˆè´¹è€…ä¸­ï¼Œç”Ÿäº§ä¸€ä¸ªæ¶ˆè´¹ä¸€ä¸ªã€‚ç”Ÿäº§ä¸€ä¸ªäº§å“ä¹‹ååªé€šçŸ¥ä¸€äººï¼Œæ¶ˆè´¹ä¸€ä¸ªäº§å“ä¹‹ååªé€šçŸ¥ä¸€äººã€‚\nåªéœ€æŠŠä»¥ä¸Šä»£ç ä¸­çš„ signalAll() æ”¹ä¸º signal()ã€‚\næ‰§è¡Œç»“æœï¼šå¤šç”Ÿäº§è€…ä¸å¤šæ¶ˆè´¹è€…äº¤æ›¿æ‰“å°ã€‚ç”Ÿäº§ä¸€ä¸ªæ‰“å°ä¸€ä¸ªã€‚ conditionP.signal() é€šçŸ¥çš„æ—¶å€™åœ¨å¤šä¸ªç”Ÿäº§è€…çº¿ç¨‹ä¸­éšæœºå”¤é†’ä¸€ä¸ªæ¥ç”Ÿäº§ã€‚conditionC.signal() é€šçŸ¥çš„æ—¶å€™åœ¨å¤šä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ä¸­éšæœºå”¤é†’ä¸€ä¸ªæ¥æ¶ˆè´¹ã€‚\nè¿™ç§æ–¹å¼æ•ˆç‡æœ€å¥½ã€‚\nä¸€ä¸ªç”Ÿäº§è€…ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œè‹¥ä½¿ç”¨ä¸€ä¸ª Conditionï¼Œsignal()    æ‰§è¡Œç»“æœï¼šä¸€ä¸ªç”Ÿäº§è€…å’Œä¸€ä¸ªæ¶ˆè´¹è€…äº¤æ›¿æ‰“å°ã€‚\n4.å…¬å¹³é”å’Œéå…¬å¹³é”    å…¬å¹³é”\n lock = new ReentrantLock(true);\n éå…¬å¹³é”\n lock = new ReentrantLock(false);\n 5.ä½¿ç”¨ Condition åŠ ä¸€ä¸ªæ§åˆ¶å˜é‡ï¼Œå¯ä»¥åŒæ­¥å„ç±»çº¿ç¨‹çš„æ‰§è¡Œé¡ºåº    è®¾å®šä¸€ä¸ªæ§åˆ¶å˜é‡ nextPrint ï¼Œå½“å‰çº¿ç¨‹æœªè½®åˆ°æ‰“å°æ—¶åˆ™æŒ‚èµ·ï¼Œè‹¥å¯ä»¥æ‰§è¡Œåˆ™æ‰§è¡Œå¹¶ä¸”é€šçŸ¥ä¸‹ä¸€ä½ï¼ˆæŠŠnextPrintçš„å€¼æ”¹å˜ï¼‰ã€‚\né¡ºåºæ˜¯ï¼šA æ‰§è¡Œï¼ŒA é€šçŸ¥ Bï¼›B æ‰§è¡Œï¼ŒB é€šçŸ¥ Cï¼›C æ‰§è¡Œï¼ŒC é€šçŸ¥ Aã€‚\n Service.java import java.util.concurrent.locks.Condition; import java.util.concurrent.locks.ReentrantLock; public class Service { private ReentrantLock lock; public Condition conditionA; public Condition conditionB; public Condition conditionC; int nextPrint = 1; public Service(ReentrantLock lock) { this.lock = lock; this.conditionA = lock.newCondition(); this.conditionB = lock.newCondition(); this.conditionC = lock.newCondition(); } public void serviceA() { try { lock.lock(); while (nextPrint != 1){ conditionA.await(); } for (int i = 0; i \u0026lt; 3; i++) { System.out.println(Thread.currentThread().getName() + \u0026#34; \u0026#34; + i); } conditionB.signalAll(); nextPrint = 2; } catch (InterruptedException e){ }finally{ lock.unlock(); } } public void serviceB() { try { lock.lock(); while (nextPrint != 2){ conditionB.await(); } for (int i = 0; i \u0026lt; 3; i++) { System.out.println(Thread.currentThread().getName() + \u0026#34; \u0026#34; + i); } conditionC.signalAll(); nextPrint = 3; } catch (InterruptedException e){ }finally{ lock.unlock(); } } public void serviceC() { try { lock.lock(); while(nextPrint != 3){ conditionC.await(); } for (int i = 0; i \u0026lt; 3; i++) { System.out.println(Thread.currentThread().getName() + \u0026#34; \u0026#34; + i); } conditionA.signal(); nextPrint = 1; } catch (InterruptedException e){ }finally{ lock.unlock(); } } }   ThreadA.java public class ThreadA extends Thread{ private Service service; public ThreadA(Service service){ this.service = service; } @Override public void run(){ service.serviceA(); } }   ThreadB.java public class ThreadB extends Thread{ private Service service; public ThreadB(Service service){ this.service = service; } @Override public void run(){ service.serviceB(); } }   ThreadC.java public class ThreadC extends Thread{ private Service service; public ThreadC(Service service){ this.service = service; } @Override public void run(){ service.serviceC(); } }   Run.java import java.util.concurrent.locks.ReentrantLock; public class Run { public static void main(String[] args) { ReentrantLock lock = new ReentrantLock(); Service service = new Service(lock); ThreadA[] threadA = new ThreadA[5]; ThreadB[] threadB = new ThreadB[5]; ThreadC[] threadC = new ThreadC[5]; for (int i = 0; i \u0026lt; 5; i++) { threadA[i] = new ThreadA(service); threadB[i] = new ThreadB(service); threadC[i] = new ThreadC(service); threadA[i].setName(\u0026#34;A\u0026#34; + i); threadB[i].setName(\u0026#34;B\u0026#34; + i); threadC[i].setName(\u0026#34;C\u0026#34; + i); threadA[i].start(); threadB[i].start(); threadC[i].start(); } } }  æ‰§è¡Œç»“æœä¸ºï¼ŒAã€Bã€C ä¸‰ç±»çº¿ç¨‹ä¾æ¬¡æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸¥æ ¼æŒ‰ç…§ABCçš„é¡ºåºã€‚\nå…¶ä»–æ–¹æ³•      lock.getHoldCount() æŸ¥è¯¢å½“å‰çº¿ç¨‹ä¿æŒæ­¤é”çš„ä¸ªæ•°ã€‚\n  lock.getQueueLength() å½“å‰åœ¨ç­‰å¾…é”é‡Šæ”¾çš„çº¿ç¨‹æ•°ã€‚åªèƒ½å¾—åˆ°å¤§è‡´çš„æ•°å­—ï¼Œç”¨äºç³»ç»ŸçŠ¶æ€ç›‘è§†ï¼Œä¸èƒ½ç”¨ä½œåŒæ­¥ã€‚\n  lock.getWaitQueueLength(Condition condition) è·å–ä¸ condition ç›¸å…³è”ä¸”å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ä¼°è®¡æ•°ã€‚\n  lock.hasQueueThread(Thread thread) æŸ¥è¯¢æŒ‡å®šçº¿ç¨‹æ˜¯å¦æ­£åœ¨ç­‰å¾…è·å–æ­¤é”å®šã€‚\n  lock.hasQueueThreads() æŸ¥è¯¢æ˜¯å¦æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–æ­¤é”å®šã€‚\n  lock.hasQueueWaiters(Condition condition) æŸ¥è¯¢æ˜¯å¦æœ‰çº¿ç¨‹æ­£åœ¨ç­‰å¾…ä¸æ­¤é”å®šæœ‰å…³çš„ conditionã€‚\n  lock.isFair() åˆ¤æ–­æ˜¯å¦ä¸ºå…¬å¹³é”ï¼ŒReentrantLock é»˜è®¤æ˜¯éå…¬å¹³é”ã€‚\n  lock.isHeldByCurrentThread() æŸ¥è¯¢å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰è¯¥é”å®šã€‚\n  lock.isLocked()\n  lock.lockInterruptibly() å¦‚æœå½“å‰çº¿ç¨‹æœªè¢«ä¸­æ–­ï¼Œåˆ™è·å–é”ï¼Œå¦‚æœå½“å‰çº¿ç¨‹å·²ç»è¢«ä¸­æ–­ï¼Œåˆ™å‡ºç°å¼‚å¸¸ã€‚\n  lock.tryLock() ä»…åœ¨è°ƒç”¨æ—¶é”å®šæœªè¢«å…¶ä»–çº¿ç¨‹ä¿æŒçš„æƒ…å†µä¸‹ï¼Œæ‰è·å–è¯¥é”ã€‚\n  lock.tryLock(long timeout, TimeUnit unit) å¦‚æœé”å®šåœ¨ç»™å®šæ—¶é—´å†…æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿æŒï¼Œä¸”å½“å‰çº¿ç¨‹æœªä¸­æ–­ï¼Œåˆ™è·å–è¯¥é”çš„é”å®šã€‚\n  condition.awaitUniterruptruptibly() è¿›è¡Œæ— è§†ä¸­æ–­å¼‚å¸¸çš„ç­‰å¾…ï¼Œåœ¨ç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¸­æ–­ä¸ä¼šè§¦å‘å¼‚å¸¸ï¼Œé”çš„ä¿æŒçŠ¶æ€ä»ç„¶ç»§ç»­ä¿æŒï¼Œç›´åˆ°è¢«é€šçŸ¥ã€‚\n  condition.awaitUntil(Date deadline) çº¿ç¨‹æœ‰é™æ—¶é—´çš„æŒ‚èµ·ã€‚åœ¨æ—¶é—´åˆ°è¾¾ä¹‹å‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹å”¤é†’ï¼Œåœ¨æ—¶é—´åˆ°è¾¾ä¹‹åè‡ªæˆ‘å”¤é†’ã€‚\n  "},{"id":4,"href":"/3.%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/3.5%E7%BA%BF%E7%A8%8B%E5%8F%98%E9%87%8F%E7%A7%81%E6%9C%89/","title":"3.5çº¿ç¨‹å˜é‡ç§æœ‰","parent":"3.çº¿ç¨‹é—´é€šä¿¡","content":"å¦‚æœéœ€è¦çº¿ç¨‹é—´è¿›è¡Œå˜é‡å…±äº«ï¼Œå¯ä»¥æŠŠå˜é‡å®šä¹‰ä¸º public static.\nå¦‚æœéœ€è¦çº¿ç¨‹å†…éƒ¨çš„å˜é‡å…±äº«ï¼Œå¯ä»¥ä½¿ç”¨ ThreadLocal.\n1. ThreadLocal    public static ThreadLocal t = new ThreadLocal();\nThreadLocal å…·æœ‰ get() å’Œ set() æ–¹æ³•ï¼Œä¸åŒçº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„åŸŸã€‚\n å­çº¿ç¨‹MyThread.java public class MyThread extends Thread{ @Override public void run(){ if (Run.t.get()==null){ System.out.println(\u0026#34;æ— \u0026#34;); Run.t.set(\u0026#34;å­çº¿ç¨‹æ•°æ®\u0026#34;); } System.out.println(Run.t.get()); } }    ä¸»çº¿ç¨‹ Run.java public class Run { public static ThreadLocal t = new ThreadLocal(); public static void main(String[] args) { MyThread s = new MyThread(); s.start(); if (t.get() == null){ System.out.println(\u0026#34;æœªæœ‰å€¼\u0026#34;); t.set(\u0026#34;Hi\u0026#34;); } System.out.println(t.get()); }   è¿è¡Œç»“æœ\n æœªæœ‰å€¼\nHi\næ— \nå­çº¿ç¨‹æ•°æ®\n è¿™è¡¨æ˜ï¼Œä¸åŒçº¿ç¨‹å»è®¿é—®åŒä¸€é™æ€åŸŸ tï¼Œæ‰€å¾—åˆ°çš„å†…å®¹æ˜¯ä¸ä¸€æ ·çš„ã€‚æ¯ä¸ªçº¿ç¨‹åªèƒ½å–å¾—å±äºè‡ªå·±çš„é‚£ä¸€ä»½ã€‚\nè‹¥éœ€è¦ç»™ ThreadLocal è®¾ç½®åˆå§‹å€¼    å¯ä»¥ç»§æ‰¿ ThreadLocal å¹¶ä¸”é‡å†™å€¼åˆå§‹åŒ–æ–¹æ³•ã€‚\npublic class MyThreadLocal extends ThreadLocal{ @Override protected Object initialValue(){ return \u0026#34;fine\u0026#34;; } } 2.InheritableThreadLocal    public static ThreadLocal t = new InheritableThreadLocal();\nçº¿ç¨‹å€¼ç»§æ‰¿    å½“å‰çº¿ç¨‹çš„å€¼ï¼Œç¬¬ä¸€æ¬¡è®¿é—®(set æˆ–è€… get)ä¹‹åæ‰ç”Ÿæ•ˆï¼Œæ‰å¯è¢«ç»§æ‰¿ã€‚\n  çˆ¶çº¿ç¨‹çš„å€¼è¢«è®¿é—®è¿‡ä¹‹åï¼Œå­çº¿ç¨‹å¯ä»¥ç»§æ‰¿çˆ¶çº¿ç¨‹çš„å€¼ï¼Œä½†å­çº¿ç¨‹å€¼ä¿®æ”¹(set)å¯¹çˆ¶çº¿ç¨‹æ²¡æœ‰å½±å“ã€‚\n  è‹¥çˆ¶çº¿ç¨‹çš„å€¼æœªè¢«è®¿é—®ï¼Œå­çº¿ç¨‹è®¿é—®æ‰€å¾—åˆ°çš„å€¼æ˜¯é»˜è®¤å€¼ã€‚\n å­çº¿ç¨‹è®¿é—®åˆ°çš„æ˜¯é»˜è®¤å€¼ public class Run { public static ThreadLocal t = new MyInheritableThreadLocal(); public static void main(String[] args) throws InterruptedException { MyThread s = new MyThread(); s.start(); } } è¿è¡Œç»“æœ\n fine\n   çˆ¶çº¿ç¨‹çš„å€¼æœ‰è¢«è®¿é—®ï¼Œåˆ™å­çº¿ç¨‹ä¼šç»§æ‰¿ public class Run { public static ThreadLocal t = new MyInheritableThreadLocal(); public static void main(String[] args) throws InterruptedException { System.out.println(t.get());//çˆ¶çº¿ç¨‹çš„å€¼æœ‰è¢«è®¿é—®  MyThread s = new MyThread(); s.start(); } } è¿è¡Œç»“æœ\n fine\nfineHa\n    çˆ¶çº¿ç¨‹ä¿®æ”¹äº†å€¼ï¼Œå¹¶ä¸”æ‰§è¡Œäº†å…¶ä»–è¯­å¥ä¹‹åï¼Œå­çº¿ç¨‹å†æ¥ç»§æ‰¿æ‰€å¾—åˆ°çš„å€¼å°±æ˜¯æ–°çš„å€¼ã€‚\n  å¦‚æœåœ¨å­çº¿ç¨‹è·å–å€¼çš„æ—¶å€™ï¼Œçˆ¶çº¿ç¨‹ä¿®æ”¹äº†å€¼ï¼Œé‚£ä¹ˆå­çº¿ç¨‹è·å–åˆ°çš„æ˜¯æ—§çš„å€¼ã€‚\n  è‹¥æƒ³è¦åœ¨ç»§æ‰¿çš„åŒæ—¶å¯¹å­çº¿ç¨‹çš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œå¯ä»¥é‡å†™ childValue æ–¹æ³•ã€‚\n MyInheritableThreadLocal.java public class MyInheritableThreadLocal extends InheritableThreadLocal{ @Override protected Object initialValue(){ return \u0026#34;fine\u0026#34;; } @Override protected Object childValue(Object parentValue){ return parentValue + \u0026#34;Ha\u0026#34;; } }    "},{"id":5,"href":"/3.%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/3.4join%E6%96%B9%E6%B3%95/","title":"3.4joinæ–¹æ³•","parent":"3.çº¿ç¨‹é—´é€šä¿¡","content":"é—®é¢˜    å­çº¿ç¨‹éœ€è¦è¿›è¡Œå¤§é‡è¿ç®—ï¼Œä¸»çº¿ç¨‹æ—©äºå­çº¿ç¨‹é€€å‡ºã€‚é‚£ä¹ˆä¸»çº¿ç¨‹æ— æ³•è·å–å­çº¿ç¨‹æ‰§è¡Œåçš„ä¿¡æ¯ã€‚\nã€è§£å†³æ–¹æ³•ã€ä¸»çº¿ç¨‹ä¸­è°ƒç”¨å­çº¿ç¨‹çš„ joinï¼Œä½¿å¾—åœ¨å­çº¿ç¨‹è¿è¡Œæ—¶ï¼Œä¸»çº¿ç¨‹è¿›å…¥ waiting çŠ¶æ€ã€‚join ä¹‹åä¸»çº¿ç¨‹åŸåœ°ç­‰å¾…å­çº¿ç¨‹é”€æ¯ã€‚\n MyThread.java public class MyThread extends Thread{ @Override public void run(){ try{ long time = (long) (Math.random() * 10000); System.out.println(\u0026#34;time:\u0026#34; + time); Thread.sleep(time); }catch(Exception e){ } } }   Run.java public class Run { public static void main(String[] args) { Thread t = new MyThread(); t.start(); try { t.join();//ä½¿å¾—ä¸»çº¿ç¨‹è¢«æ— é™æœŸé˜»å¡ï¼Œç­‰å¾…å­çº¿ç¨‹é”€æ¯  } catch (Exception e){ } System.out.println(\u0026#34;can\u0026#34;); System.out.println(\u0026#34;you\u0026#34;); } }  join ä¹‹åï¼Œçº¿ç¨‹çš„ interrupt() æ–¹æ³•å¯ä»¥å¼•å‘ InterruptedException     ThreadA.java public class ThreadA extends Thread{ @Override public void run(){ try { for(int i = 0; ; i++){ String str = new String(\u0026#34;fine\u0026#34;); if (isInterrupted()){ throw new InterruptedException(); } } }catch (InterruptedException e){ e.printStackTrace(); } } }   ThreadB.java public class ThreadB extends Thread{ ThreadA a; @Override public void run(){ try{ a = new ThreadA(); a.start(); a.join(); System.out.println(\u0026#34;çº¿ç¨‹Bç»§ç»­æ‰§è¡Œ\u0026#34;); }catch (InterruptedException e){ System.out.println(\u0026#34;çº¿ç¨‹Bè¢«ä¸­æ–­\u0026#34;); e.printStackTrace(); a.interrupt(); } } }   Run.java public class Run { public static void main(String[] args) { ThreadB b = new ThreadB(); b.start(); b.interrupt(); } }  é»˜è®¤æƒ…å†µä¸‹ï¼Œinterrupt() æ–¹æ³•ä¸ä¼šå¼•èµ·çº¿ç¨‹å¼‚å¸¸ï¼Œåƒçº¿ç¨‹Aã€‚è€Œåƒçº¿ç¨‹ B æœ‰è°ƒç”¨äº†å®ƒçš„ join()ï¼Œå†è°ƒç”¨ interrupt() æ–¹æ³•å°±ä¼šå¼•èµ·çº¿ç¨‹çš„ä¸­æ–­å¼‚å¸¸ã€‚\nè¿è¡Œç»“æœ\njoin(long) ä¸ sleep(long) çš„åŒºåˆ«     join å†…éƒ¨ä½¿ç”¨ wait() æ¥å®ç°ï¼Œæ‰€ä»¥ä¼šé‡Šæ”¾é”ï¼Œå…è®¸å…¶ä»–çº¿ç¨‹è¿›å…¥åŒæ­¥åŒºåŸŸã€‚ sleep ä¸ä¼šé‡Šæ”¾é”ã€‚ join ä¹‹åä¸»çº¿ç¨‹åŸåœ°ç­‰å¾…å­çº¿ç¨‹é”€æ¯ã€‚ ä¸»çº¿ç¨‹è°ƒç”¨ wait éœ€è¦è·å–å­çº¿ç¨‹ t çš„å¯¹è±¡é”ï¼Œå› ä¸º t.join() æ¶‰åŠåˆ° wait() å’ŒåŒæ­¥ã€‚   ThreadA.java public class ThreadA extends Thread{ ThreadB b; public ThreadA(ThreadB b){ this.b = b; } @Override public void run(){ try { synchronized (b){ b.start(); b.join(6000);//é‡Šæ”¾äº†å½“å‰çº¿ç¨‹å¯¹ b çš„é”  while(true){ } } }catch (Exception e){ e.printStackTrace(); } } }  æ‰§è¡Œç»“æœ\n B å¼€å§‹\nB æœåŠ¡\nB ç»“æŸ\n join åé¢çš„å†…å®¹æå‰æ‰§è¡Œ     ThreadA.java public class ThreadA extends Thread{ ThreadB b; public ThreadA(ThreadB b){ this.b = b; } @Override public void run(){ try { synchronized (b){ System.out.println(\u0026#34;A start\u0026#34;); Thread.sleep(5000);//ä¸é‡Šæ”¾é”ï¼Œä¸»çº¿ç¨‹æ— æ³•è®¿é—® b  //b.wait();//ä¼šé‡Šæ”¾é”  System.out.println(\u0026#34;A end\u0026#34;); } }catch (Exception e){ e.printStackTrace(); } } }   ThreadB.java public class ThreadB extends Thread{ @Override synchronized public void run(){ try{ System.out.println(\u0026#34;B start\u0026#34;); Thread.sleep(6000); System.out.println(\u0026#34;B end\u0026#34;); }catch (InterruptedException e){ e.printStackTrace(); } } }   Run.java public class Run { public static void main(String[] args) { ThreadB b = new ThreadB(); ThreadA a = new ThreadA(b); try{ a.start();//ä¸€æ—¦çº¿ç¨‹ a è¿›å…¥ runï¼Œä¼šå æœ‰ b é”å¹¶ä¸”ä¸é‡Šæ”¾ã€‚  b.start(); b.join(4000);//è¿™ä¸€è¡Œæ¯”å‰é¢ä¸¤ä¸ª start éƒ½è¦æ—©æ‰§è¡Œï¼Œä¸»çº¿ç¨‹é˜»å¡ç­‰å¾… b çº¿ç¨‹ 4000msã€‚  System.out.println(\u0026#34;Main end\u0026#34;); }catch (InterruptedException e){ } } }  æ‰§è¡Œé¡ºåº\nè¿è¡Œç»“æœæœ‰ä¸‰ç§å¯èƒ½\n    b.join(4000) å…ˆæ‹¿åˆ°é”å¹¶ä¸”å¾ˆå¿«é‡Šæ”¾ã€‚ a æ‹¿åˆ°é”ï¼Œå¼€å§‹æ‰§è¡Œï¼Œä¸é‡Šæ”¾é”ã€‚æŒç»­ 5000msã€‚ b.join(4000) æ¯”çº¿ç¨‹ b å…ˆæ‹¿åˆ°é”ï¼Œä½†å¾ˆå¿«åˆé‡Šæ”¾ï¼Œä½†æ­¤æ—¶å·²ç»è¿‡äº† 4000ms ï¼Œäºæ˜¯ä¸»çº¿ç¨‹ä¸å†é˜»å¡ï¼Œç»§ç»­æ‰§è¡Œæ‰“å° Main endã€‚ b.start() æ‹¿åˆ°é”å°±å¼€å§‹æ‰§è¡Œï¼Œä¸é‡Šæ”¾é”ã€‚æŒç»­ 6000msã€‚   A start\nA end\nMain end\nB start\nB end\n å’Œç¬¬ä¸€ç§æƒ…å†µä¸€æ ·ï¼Œåªæ˜¯ ThreadB åœ¨äº‰å¤ºé”çš„æ—¶å€™æ¯” Main end çš„æ‰“å°å¿«äº†ä¸€ç‚¹ã€‚   Main end å’Œã€B å¼€å§‹ã€å¼‚æ­¥æ‰“å°ï¼ŒMain end æ…¢äº†ä¸€ç‚¹ã€‚   A start\nA end\nB start\nMain end\nB end\n    b.join(4000) å…ˆæ‹¿åˆ°é”å¹¶ä¸”å¾ˆå¿«é‡Šæ”¾ã€‚ a æ‹¿åˆ°é”ï¼Œå¼€å§‹æ‰§è¡Œï¼Œä¸é‡Šæ”¾é”ã€‚æŒç»­ 5000msã€‚ çº¿ç¨‹ b æ¯” b.join(4000) å…ˆæ‹¿åˆ°é”ï¼Œä¸é‡Šæ”¾é”ï¼ŒæŒç»­ 6000msã€‚ç„¶åè¾“å‡ºã€ç»“æŸã€ b.join(4000) å†æ¬¡æ‹¿åˆ°é”ã€‚æ—¶é—´å·²ç»è¶…è¿‡ 4000ms, ä¸»çº¿ç¨‹ä¸å†ç­‰å¾…ï¼Œæ‰“å° Main endã€‚   A start\nA end\nB start\nB end\nMain end\n "},{"id":6,"href":"/3.%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/3.3%E7%AE%A1%E9%81%93%E6%B5%81/","title":"3.3ç®¡é“æµ","parent":"3.çº¿ç¨‹é—´é€šä¿¡","content":"ä¸€ä¸ªçº¿ç¨‹å‘é€æ•°æ®åˆ°è¾“å‡ºç®¡é“ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ä»è¾“å…¥ç®¡é“ä¸­è¯»å–æ•°æ®ã€‚\nå·¥å…·ç±»ï¼šPipedInputStream, PipedOutputStream, PipedReader, PipedWriter\nPipedInputStream é€šä¿¡å¤§å°æœ‰é™åˆ¶ï¼Œä¸€ä¸ªæ‰¹æ¬¡é»˜è®¤æ˜¯ 1024 å­—èŠ‚ã€‚\nå‘é€è€…å†™æ»¡ 1024 å­—èŠ‚åï¼Œæ¥æ”¶è€…å¼€å§‹è¯»å–ï¼Œè¯»å–å®Œæˆä¸€æ‰¹ä¹‹åå†å¼€å§‹ä¸‹ä¸€æ‰¹ã€‚\nä¼ è¾“å­—èŠ‚æµ     WriteData.java import java.io.PipedOutputStream; public class WriteData { public void write(PipedOutputStream outputStream){ try{ System.out.println(\u0026#34;Write:\u0026#34; + Thread.currentThread().getName()); for (int i = 0; i \u0026lt; 300; i++) { String s = \u0026#34;i=\u0026#34; + i; outputStream.write(s.getBytes()); System.out.println(s); } }catch (Exception e){ } } }   ReadData.java import java.io.PipedInputStream; public class ReadData { public void read(PipedInputStream inputStream){ try{ System.out.println(\u0026#34;Read:\u0026#34; + Thread.currentThread().getName()); byte [] data = new byte[40]; int b = inputStream.read(data); while(b != -1){ String str = new String(data, 0, b); System.out.println(str); b = inputStream.read(data); } }catch (Exception e){ } } }   ThreadWrite.java import java.io.PipedOutputStream; public class ThreadWrite extends Thread{ private WriteData writeData; private PipedOutputStream outputStream; public ThreadWrite(PipedOutputStream outputStream, WriteData writeData){ this.outputStream = outputStream; this.writeData = writeData; } @Override public void run(){ writeData.write(outputStream); } }   ThreadRead.java import java.io.PipedInputStream; public class ThreadRead extends Thread{ private PipedInputStream inputStream; private ReadData readData; public ThreadRead(PipedInputStream inputStream, ReadData readData){ this.inputStream = inputStream; this.readData = readData; } @Override public void run(){ readData.read(inputStream); } }   Run.java import java.io.PipedInputStream; import java.io.PipedOutputStream; public class Run { public static void main(String[] args) { WriteData writeData = new WriteData(); ReadData readData = new ReadData(); PipedInputStream inputStream = new PipedInputStream(); PipedOutputStream outputStream = new PipedOutputStream(); try { outputStream.connect(inputStream); // connect pipe  }catch (Exception e){ } ThreadWrite write = new ThreadWrite(outputStream, writeData); ThreadRead read = new ThreadRead(inputStream, readData); write.setName(\u0026#34;å‘é€è€…\u0026#34;); read.setName(\u0026#34;æ¥æ”¶è€…\u0026#34;); write.start(); read.start(); } }  åˆšåˆšå¼€å§‹çš„æ—¶å€™ï¼Œç¼“å­˜åŒºæ²¡æœ‰å†…å®¹ï¼Œæ¥æ”¶è€…çº¿ç¨‹é˜»å¡åœ¨ int b = inputStream.read(data); ç›´åˆ°æ•´æ‰¹å†…å®¹å†™å®Œã€‚å†™å’Œè¯»çš„çº¿ç¨‹ä¹‹é—´é€šè¿‡ b æ¥åŒæ­¥ã€‚\nä¼ è¾“å­—ç¬¦æµ    write æ—¶\noutputStream.write(str);\nread æ—¶\nchar[] data = new char[40];\nString str = new String(data, 0, length);\n"},{"id":7,"href":"/3.%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/3.2%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%BC%8F/","title":"3.2ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼","parent":"3.çº¿ç¨‹é—´é€šä¿¡","content":"é—®é¢˜ï¼š\n threadP åœ¨ setValue æ—¶ï¼Œlock.wait å¤±å»äº†é”, çº¿ç¨‹è¿˜ä¼šç»§ç»­å­˜åœ¨å—ï¼Ÿ ã€è§£ç­”ã€è¿˜ä¼šç»§ç»­å­˜åœ¨, ä½†æ˜¯å¤„äº waiting çŠ¶æ€ã€‚æ²¡æœ‰èƒ½åŠ›å»è·å–åŒæ­¥é”ã€‚\n  é”æ˜¯å¯ä»¥é‡å…¥çš„ï¼Œæ˜¯å¦æ„å‘³ç€åœ¨ while å¾ªç¯çš„ä½œç”¨ä¸‹ï¼Œä¼šå¤šæ¬¡è°ƒç”¨ setValueï¼Œè€Œæœ‰ä¸€éƒ¨åˆ†çš„è°ƒç”¨è¢«é˜»å¡äº†å¾—ä¸åˆ°å“åº”ï¼Ÿ ã€è§£ç­”ã€ä¸ä¼šå¤šæ¬¡è°ƒç”¨ setValue, å› ä¸ºæ‰§è¡Œäº†lockã€‚wait() ä¹‹åçº¿ç¨‹è¢«æŒ‚èµ·äº†ã€‚\n  é”å¯ä»¥é‡å…¥ï¼Œåœ¨ä¸Šä¸€ä¸ª lock.wait æœªå“åº”çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¦å¯ä»¥å†è¿›å…¥åŒæ­¥å—è¿›è¡Œå¯¹åº”æ“ä½œï¼Ÿ ã€è§£ç­”ã€æ‰§è¡Œäº† lock.wait çº¿ç¨‹å°±è¢«æŒ‚èµ·ï¼Œè¿›å…¥ waiting çŠ¶æ€ã€‚\n ä¸€ä¸ªç”Ÿäº§è€…ã€ä¸€ä¸ªæ¶ˆè´¹è€…    åŸºäº wait/notify æœºåˆ¶\nè‹¥æ•°æ®åŸŸæœ‰å†…å®¹ï¼Œåˆ™ç”Ÿäº§è€…ä¸ç”Ÿäº§ï¼Œçº¿ç¨‹æŒ‚èµ·ï¼›åä¹‹ï¼Œç”Ÿäº§è€…ç”Ÿäº§äº§å“å¹¶ä¸”å‘å‡ºé€šçŸ¥ã€‚\nè‹¥æ•°æ®åŸŸæ²¡æœ‰å†…å®¹ï¼Œåˆ™æ¶ˆè´¹è€…ä¸æ¶ˆè´¹ï¼Œçº¿ç¨‹æŒ‚èµ·ï¼›åä¹‹ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹äº§å“å¹¶ä¸”å‘å‡ºé€šçŸ¥ã€‚\n P.java public class P { String lock; public P(String lock){ this.lock = lock; } public void setValue(){ try{ synchronized(lock){ //ä½¿ç”¨ if æ˜¯ä¸ä¸¥è°¨çš„åšæ³•  if (!ValueObject.value.equals(\u0026#34;\u0026#34;)){ lock.wait();//lock will be release, but thread exist always(waiting), and the thread loss the ability to get lock.  } String str = System.currentTimeMillis() + \u0026#34;_\u0026#34; + System.nanoTime(); System.out.println(\u0026#34;Set:\u0026#34; + str); //Produce and notify  ValueObject.value = str; lock.notify(); } }catch (Exception e){ } } }   C.java public class C String lock; public C(String lock){ this.lock = lock; } public void getValue(){ try{ synchronized(lock){ //ä½¿ç”¨ if æ˜¯ä¸ä¸¥è°¨çš„åšæ³•  if (ValueObject.value.equals(\u0026#34;\u0026#34;)){ lock.wait(); } String str = ValueObject.value; System.out.println(\u0026#34;Get:\u0026#34; + str); //Consume and notify  ValueObject.value = \u0026#34;\u0026#34;; lock.notify(); } }catch (Exception e){ } } }   ThreadP.java public class ThreadP extends Thread{ public P p; public ThreadP(P p){ super(); this.p = p; } @Override public void run(){ while(true){ p.setValue(); } } }   ThreadC.java public class ThreadC extends Thread{ public C c; public ThreadC(C c){ super(); this.c = c; } @Override public void run(){ while(true){ c.getValue(); } } }   Run.java public class Run { public static void main(String[] args){ String lock = \u0026#34;s\u0026#34;; Thread producer = new ThreadP(new P(lock)); Thread consumer = new ThreadC(new C(lock)); consumer.start(); producer.start(); } }  å¤šç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…    å¤šä¸ªç”Ÿäº§è€…å’Œå¤šä¸ªæ¶ˆè´¹è€…å…±åŒç«äº‰ä¸€æŠŠé”ã€‚ å¤šä¸ªç”Ÿäº§è€…è‹¥ä½¿ç”¨ notify è¿›è¡Œé€šçŸ¥ï¼Œåˆ™å¯èƒ½å‡ºç°ã€ç”Ÿäº§è€…é€šçŸ¥æ¶ˆè´¹è€…ã€æ¶ˆè´¹è€…é€šçŸ¥ç”Ÿäº§è€…ã€ç”Ÿäº§è€…é€šçŸ¥ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…é€šçŸ¥æ¶ˆè´¹è€…ã€çš„æƒ…å†µï¼Œè‹¥é€šçŸ¥å‡ºé”™çš„æƒ…å†µæŒç»­ç´¯ç§¯ï¼Œå°±ä¼šé€ æˆç¨‹åºå‡æ­»ã€‚\n  P.java  public class P { String lock; public P(String lock){ this.lock = lock; } public void setValue(){ try{ synchronized(lock){ while (!ValueObject.value.equals(\u0026#34;\u0026#34;)){ lock.wait(); } String str = System.currentTimeMillis() + \u0026#34;_\u0026#34; + System.nanoTime(); System.out.println(Thread.currentThread().getName() + \u0026#34; Set:\u0026#34; + str); //Produce and notify  ValueObject.value = str; lock.notify(); } }catch (Exception e){ } } }    C.java  public class C { String lock; public C(String lock){ this.lock = lock; } public void getValue(){ try{ synchronized(lock){ while (ValueObject.value.equals(\u0026#34;\u0026#34;)){ lock.wait(); } String str = ValueObject.value; System.out.println(Thread.currentThread().getName() + \u0026#34; Get:\u0026#34; + str); //Consume and notify  ValueObject.value = \u0026#34;\u0026#34;; lock.notify(); } }catch (Exception e){ } } }    ThreadP.java  public class ThreadP extends Thread{ public P p; public ThreadP(P p){ super(); this.p = p; } @Override public void run(){ while(true){ p.setValue(); } } }    ThreadC.java  public class ThreadC extends Thread{ public C c; public ThreadC(C c){ super(); this.c = c; } @Override public void run(){ while(true){ c.getValue(); } } }    run.java  public class Run { public static void main(String[] args){ String lock = \u0026#34;s\u0026#34;; Thread[] producer = new ThreadP[2]; Thread[] consumer = new ThreadC[2]; for (int i = 0; i \u0026lt; 2; i++) { producer[i] = new ThreadP(new P(lock)); producer[i].setName(\u0026#34;ç”Ÿäº§è€…\u0026#34; + (i+1)); consumer[i] = new ThreadC(new C(lock)); consumer[i].setName(\u0026#34;æ¶ˆè´¹è€…\u0026#34; + (i+1)); producer[i].start(); consumer[i].start(); } } }  ä»¥ä¸Šä»£ç åªéšæœºé€šçŸ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œå³æ˜¯è¯´ä¸èƒ½ç¡®å®šé€šçŸ¥çš„å¯¹è±¡æ˜¯æ¶ˆè´¹è€…è¿˜æ˜¯ç”Ÿäº§è€…ï¼Œå¦‚ä¸‹å›¾ï¼Œå½“ç”Ÿäº§è€…ç”Ÿäº§äº§å“ä¹‹åè‹¥é€šçŸ¥çš„æ˜¯å…¶ä»–ç”Ÿäº§è€…çº¿ç¨‹ï¼Œå°±ä¼šå‡ºç°å‡æ­»ã€‚\nå¦‚ä½•è§£å†³ notify é€šçŸ¥ä¸åˆ°å…¶ä»–ç±»ï¼ˆå‡æ­»ï¼‰ï¼Ÿ\n ä½¿ç”¨ notifyAll()\n é€šçŸ¥(notify)çš„é€Ÿåº¦æ¯”ç›´æ¥ä»£ç æ‰§è¡Œ(æ¯”å¦‚ while è¯­å¥)æ…¢ã€‚\nå› ä¸ºé€šçŸ¥æ¶‰åŠåˆ°çº¿ç¨‹è°ƒåº¦ï¼Œæ‰€ä»¥ notifyAll ä¹‹åï¼ŒåŒæ­¥å—ç»“æŸé‡Šæ”¾é”, whileä¼šç›´æ¥è¿›è¡Œä¸‹ä¸€æ¬¡çš„ setValue æˆ–è€… getValue.\nå…³äº while å’Œ if çš„é—®é¢˜ï¼š    é”™è¯¯çš„ä½¿ç”¨ï¼ˆç­‰å¾…çš„æ¡ä»¶å‘ç”Ÿäº†æ”¹å˜ï¼‰\nå¤šä¸ªçº¿ç¨‹å…ˆåè¿›å…¥ ifã€€å—çš„çš„æ—¶å€™ï¼Œæ¡ä»¶è¿˜æ˜¯æ»¡è¶³çš„ï¼Œäºæ˜¯å¤šä¸ªçº¿ç¨‹è¿›å…¥waitingã€€çŠ¶æ€ï¼Œå¹¶ä¸”é‡Šæ”¾é”ã€‚å½“å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ç¦»å¼€ç­‰å¾…çŠ¶æ€ï¼Œå¹¶ä¸”é€šçŸ¥æ¶ˆè´¹è€…æ¥ä¿®æ”¹è¿›å…¥ç­‰å¾…çš„æ¡ä»¶ï¼ˆã€€valueã€€è¢«æ¸…ç©ºï¼‰ï¼Œé‚£ä¹ˆå…¶ä»–å¤„äºç­‰å¾…çš„çº¿ç¨‹è¿˜æ˜¯ä¼šè¢«å”¤é†’ï¼Œä¹Ÿåšå‡ºä¸€æ ·çš„åŠ¨ä½œã€‚\nè¿è¡Œè¿‡ç¨‹ä¸­é€ æˆäº†ã€ç”Ÿäº§è€…ï¼‘ç”Ÿäº§ä¹‹åï¼Œé€šçŸ¥æ‰€æœ‰ã€‚ç”Ÿäº§è€…ï¼’è¢«é€šçŸ¥åˆ°åˆ™ç»§ç»­ç”Ÿäº§ï¼Œé€šçŸ¥æ‰€æœ‰ã€‚ç”Ÿäº§è€…1è¢«é€šçŸ¥åˆ°åˆ™ç»§ç»­ç”Ÿäº§ï¼Œé€šçŸ¥æ‰€æœ‰ã€‚å¾ªç¯å¾€å¤ã€ã€ã€æ¶ˆè´¹è€…ï¼‘æ¶ˆè´¹äº†äº§å“ï¼Œé€šçŸ¥æ‰€æœ‰ã€‚æ¶ˆè´¹è€…ï¼’è¢«é€šçŸ¥åˆ°åˆ™ç»§ç»­æ¶ˆè´¹ï¼Œé€šçŸ¥æ‰€æœ‰ã€‚æ¶ˆè´¹è€…ï¼‘è¢«é€šçŸ¥åˆ°åˆ™ç»§ç»­æ¶ˆè´¹ï¼Œé€šçŸ¥æ‰€æœ‰ã€‚å¾ªç¯å¾€å¤ã€çš„é—®é¢˜çš„å¶ç„¶å‡ºç°ã€‚\nsynchronized(lock){ //ä½¿ç”¨ ifï¼Œå¤„äº waiting çŠ¶æ€çš„çº¿ç¨‹è¢«é€šçŸ¥ï¼Œè‹¥ ValueObject.value ä¸ºç©ºï¼Œåˆ™åœ¨æ¡ä»¶ä¸æ»¡è¶³çš„æƒ…å†µä¸‹ä¹Ÿä¼šæ‰§è¡Œä¸šåŠ¡ä»£ç ï¼ˆifå¤–é¢çš„éƒ¨åˆ†ï¼‰  if (!ValueObject.value.equals(\u0026#34;\u0026#34;)){ System.out.println(Thread.currentThread().getName() +\u0026#34; waiting\u0026#34;); lock.wait(); } String str = System.currentTimeMillis() + \u0026#34;_\u0026#34; + System.nanoTime(); System.out.println(Thread.currentThread().getName() +\u0026#34; running\u0026#34; + \u0026#34; Set:\u0026#34; + str + \u0026#34; : \u0026#34;+ ValueObject.num++); //Produce and notify  ValueObject.value = str; lock.notify(); } æ­£ç¡®çš„ä½¿ç”¨ï¼š\nwaitingã€€çŠ¶æ€çš„çº¿ç¨‹è¢«é€šçŸ¥ä¹‹åï¼Œè¦å†æ¬¡åˆ¤æ–­æ˜¯å¦åº”è¯¥ç»§ç»­ç­‰å¾…ï¼ˆå¯¹ç­‰å¾…æ¡ä»¶å†æ¬¡åˆ¤æ–­ï¼‰ã€‚\nsynchronized(lock){ //æ­¤å¤„ä½¿ç”¨çš„æ˜¯ whileã€‚å¤„äº waiting çŠ¶æ€çš„çº¿ç¨‹è¢«é€šçŸ¥æ—¶ï¼Œè‹¥ValueObject.value ä¸ºç©ºï¼Œåˆ™çº¿ç¨‹åº”è¯¥ç»§ç»­ç­‰å¾…ã€‚  while (!ValueObject.value.equals(\u0026#34;\u0026#34;)){ System.out.println(Thread.currentThread().getName() +\u0026#34; waiting\u0026#34;); lock.wait(); } String str = System.currentTimeMillis() + \u0026#34;_\u0026#34; + System.nanoTime(); System.out.println(Thread.currentThread().getName() +\u0026#34; running\u0026#34; + \u0026#34; Set:\u0026#34; + str + \u0026#34; : \u0026#34;+ ValueObject.num++); //Produce and notify  ValueObject.value = str; lock.notify(); } è¿™æ ·çš„å¤šä¸ªç”Ÿäº§è€…å¯¹å¤šä¸ªæ¶ˆè´¹è€…çš„æ¨¡å¼ç±»ä¼¼äºç‚¹å¯¹ç‚¹é€šä¿¡ã€‚\nå¯¹äºåŒä¸€å—æ•°æ®åŸŸï¼Œè‡ªå·±æ“ä½œäº†æ•°æ®åŸŸå°±å¾—é€šçŸ¥å…¶ä»–çš„æ‰€æœ‰çš„ç«¯ï¼Œåœ¨æ”¶åˆ°é€šçŸ¥çš„æ—¶å€™éœ€è¦å†æ¬¡ç¡®è®¤æ•°æ®åŸŸæ˜¯å¦å¯æ“ä½œï¼Œä¸å¯æ“ä½œåˆ™å†æ¬¡è¿›å…¥ç­‰å¾…ã€‚\nç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼çš„æ€»ç»“     é¦–å…ˆéœ€è¦ç¡®ä¿ä½¿ç”¨åŒä¸€æŠŠé”ã€‚ ä¸€ä¸ªç”Ÿäº§è€…ä¸€ä¸ªæ¶ˆè´¹è€…çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ if ä¸ notify ä¸ä¼šå½±å“çº¿ç¨‹çš„æ‰§è¡Œé€»è¾‘ã€‚ ã€ä¸€ä¸ªç”Ÿäº§è€…å¤šä¸ªæ¶ˆè´¹è€…ã€å¤šä¸ªç”Ÿäº§è€…ä¸€ä¸ªæ¶ˆè´¹è€…ã€å¤šä¸ªç”Ÿäº§è€…å¤šä¸ªæ¶ˆè´¹è€…ã€çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»ä½¿ç”¨ while å’Œ notifyAll æ¥ä¿è¯ç¨‹åºè¿è¡Œå‡†ç¡®ã€‚ lock.wait()ä½¿å¾—å½“å‰çº¿ç¨‹è¿›å…¥ waiting çŠ¶æ€ï¼Œå¹¶ä¸”é‡Šæ”¾é”ã€‚  "},{"id":8,"href":"/3.%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/3.1%E7%AD%89%E5%BE%85%E4%B8%8E%E9%80%9A%E7%9F%A5%E6%9C%BA%E5%88%B6/","title":"3.1ç­‰å¾…ä¸é€šçŸ¥æœºåˆ¶","parent":"3.çº¿ç¨‹é—´é€šä¿¡","content":"while è½®è¯¢å­˜åœ¨ç¼ºé™·      A çº¿ç¨‹æ‰§è¡Œæ¯ä¸€æ­¥çš„æ—¶é—´è¾ƒé•¿ã€‚\npublic class ThreadA extends Thread{ private MyList list; public ThreadA(MyList list){ super(); this.list = list; } @Override public void run(){ super.run(); try{ for (int i = 0; i \u0026lt; 10; i++) { list.add(); System.out.println(Thread.currentThread().getName() + \u0026#34; Add \u0026#34; + i); Thread.sleep(1000); } }catch (InterruptedException e){ e.printStackTrace(); } } }   Bçº¿ç¨‹æ‰§è¡Œè½®è¯¢çš„æ—¶é—´è¾ƒçŸ­\npublic class ThreadB extends Thread{ private MyList list; public ThreadB(MyList list){ super(); this.list = list; } @Override public void run(){ super.run(); try{ while (true){ if(list.size() \u0026gt;= 5){ System.out.println(\u0026#34;B Up to five.\u0026#34;); throw new InterruptedException(); } Thread.sleep(20); } }catch (InterruptedException e){ e.printStackTrace(); } } }   çº¿ç¨‹ A å’Œ æ‰§è¡Œå¾ªç¯æ¯è½®ä¼šä¼‘æ¯ 1sï¼Œçº¿ç¨‹ B æ¯éš” 20ms å¯¹ size è¿›è¡Œè®¿é—®ã€‚è€Œçº¿ç¨‹ B çš„è½®è¯¢ï¼Œè‹¥æ—¶é—´å¤ªé•¿åˆ™æ— æ³•å‡†ç¡®æ•æ‰ list.sizeçš„å˜åŒ–ï¼›è‹¥æ—¶é—´å¤ªçŸ­åˆ™è€—è´¹å¤§é‡çš„ CPU èµ„æºã€‚\næ‰€ä»¥ï¼Œä½¿ç”¨ while æ¥è½®è¯¢å˜é‡æˆ–è€…å¯¹è±¡å±æ€§ï¼Œä¼šé€ æˆ CPU èµ„æºçš„æµªè´¹ï¼›è½®è¯¢é—´éš”è¶ŠçŸ­ï¼Œè¶Šè€—è´¹èµ„æºã€‚\næˆ‘ä»¬ä½¿ç”¨ä¸€ç§ç§°ä¸º wait/notify çš„æœºåˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nå¤šçº¿ç¨‹å…±äº«å˜é‡ï¼Œä¼šæœ‰åŒæ­¥çš„é—®é¢˜ï¼Œçº¿ç¨‹æ— æ³•ç¡®ä¿è¯»å–åˆ°çš„å˜é‡å€¼æ˜¯ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œ wait/notifyæœºåˆ¶ æ°å¥½å¯ä»¥è§£å†³åŒæ­¥è¿™ä¸ªé—®é¢˜ã€‚\nwait/notify æœºåˆ¶    Java çš„å¯¹è±¡éƒ½æœ‰ wait() æ–¹æ³•å’Œ notify() æ–¹æ³•ï¼Œä½†éœ€è¦åŒæ­¥åŠ é”æ‰èƒ½ä½¿ç”¨è¿™ä¸ª wait/notify æœºåˆ¶ã€‚\n  ä¸¤ä¸ªçº¿ç¨‹å…±ç”¨ä¸€ä¸ªå¯¹è±¡ç›‘è§†å™¨ lock ã€å…±ç”¨ä¸€æŠŠé”ã€\nä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œè°ƒç”¨å¯¹è±¡ç›‘è§†å™¨çš„ wait()ï¼Œè¯¥çº¿ç¨‹é‡Šæ”¾é”ï¼Œå¹¶ä¸”è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚\nå¦å¤–ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨éœ€è¦çš„æ—¶å€™è°ƒç”¨å¯¹è±¡ç›‘è§†å™¨çš„ notify() æ–¹æ³•ï¼Œä¼šé‡Šæ”¾é”ï¼Œå¹¶ä¸”éšæœºå”¤é†’ç­‰å¾…åŒä¸€å…±äº«èµ„æºçš„ä¸€ä¸ªçº¿ç¨‹ï¼Œä½† notify æ˜¯ç­‰åˆ°åŒæ­¥å—æ‰§è¡Œå®Œæˆæ‰é‡Šæ”¾é”ã€‚\n  ThreadA.java\npublic class ThreadA extends Thread{ private Object lock; public ThreadA(Object lock){ super(); this.lock = lock; } @Override public void run(){ super.run(); synchronized (lock){ System.out.println(\u0026#34;start.\u0026#34;); try { lock.wait(); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(\u0026#34;end\u0026#34;); } } }   ThreadB.java\npublic class ThreadB extends Thread{ private Object lock; public ThreadB(Object lock){ super(); this.lock = lock; } @Override public void run(){ super.run(); synchronized (lock){ for (int i = 0; i \u0026lt; 7; i++) { System.out.println(i); try { Thread.sleep(1000); }catch (InterruptedException e){ e.printStackTrace(); } if (i == 4){ lock.notify(); } } } } }   Run.java\npublic class Run { public static void main(String[] args) { Object lock = new Object(); ThreadA A = new ThreadA(lock); A.setName(\u0026#34;A\u0026#34;); A.start(); ThreadB B = new ThreadB(lock); B.setName(\u0026#34;B\u0026#34;); B.start(); } } å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ i = 4 æ—¶è°ƒç”¨notify( )ï¼Œå¹¶ä¸ä¼šé©¬ä¸Šé‡Šæ”¾é”ã€‚\n    çº¿ç¨‹çŠ¶æ€\n  NEW æ–°å»º\n  RUNNABLE å°±ç»ªçŠ¶æ€\nçº¿ç¨‹å¯ä»¥ CPU è°ƒåº¦ï¼Œè‹¥è¯¥çº¿ç¨‹æŠ¢å åˆ°äº† CPU èµ„æºï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›å…¥ RUNNING çŠ¶æ€ã€‚\nè¿›å…¥ Running çŠ¶æ€çš„æƒ…å†µ\n Sleep() ä¼‘çœ å·²ç»“æŸã€‚ çº¿ç¨‹è°ƒç”¨çš„é˜»å¡ IO å·²è¿”å›ï¼Œé˜»å¡æ–¹æ³•æ‰§è¡Œå®Œæ¯•ã€‚ çº¿ç¨‹æˆåŠŸè·å¾—äº†é”ä¹‹åã€‚ æ­£åœ¨ç­‰å¾…é€šçŸ¥çš„çº¿ç¨‹ï¼Œè¢«å…¶ä»–çº¿ç¨‹é€šçŸ¥ï¼Œå¹¶ä¸”æœ‰æœ€é«˜çš„ä¼˜å…ˆçº§æ¥æ‰§è¡Œã€‚ å¤„äºæŒ‚èµ·çŠ¶æ€çš„çº¿ç¨‹è°ƒç”¨äº† resume æ–¹æ³•ã€‚    BLOCKED é˜»å¡\næ¯”å¦‚é‡åˆ° IO æ“ä½œï¼Œå½“å‰çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼ŒæŠŠ CPU æ—¶é—´ç‰‡è®©ç»™å…¶ä»–çº¿ç¨‹ã€‚Blocked çŠ¶æ€ç»“æŸåï¼Œçº¿ç¨‹è¿›å…¥Runnable çŠ¶æ€ã€‚\nè¿›å…¥ Blocked çŠ¶æ€çš„æƒ…å†µ\n çº¿ç¨‹è°ƒç”¨ Sleep() ï¼Œä¸»åŠ¨æ”¾å¼ƒå ç”¨ CPU èµ„æºã€‚ çº¿ç¨‹è°ƒç”¨äº† é˜»å¡å¼ IOï¼Œåœ¨è¯¥æ–¹æ³•è¢«è¿”å›å‰ï¼Œè¯¥çº¿ç¨‹è¢«é˜»å¡ã€‚ çº¿ç¨‹è¯•å›¾è·å¾—åŒæ­¥ç›‘è§†å™¨ï¼Œä½†è¯¥åŒæ­¥ç›‘è§†å™¨æ­£åœ¨è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ã€‚ï¼ˆè½®ä¸åˆ°è·å¾—åŒæ­¥é”ï¼‰ å¤šä¸ªçº¿ç¨‹åŒæ—¶æ”¶åˆ°å¯è§¦å‘çš„é€šçŸ¥ï¼Œä¼˜å…ˆçº§é«˜çš„å…ˆè·å¾—é”å¾—ä»¥è¿›å…¥runable çŠ¶æ€ï¼Œå…¶ä»–çº¿ç¨‹å¤„äº blocked çŠ¶æ€ã€‚ æŸä¸ªçº¿ç¨‹è°ƒç”¨äº† å…¶ä»–çº¿ç¨‹çš„ suspend æ–¹æ³•å°†å…¶ä»–çº¿ç¨‹æŒ‚èµ·ï¼Œè¢«æŒ‚èµ·è€…è¿›å…¥ Blocked çŠ¶æ€ã€‚è¯¥æ–¹æ³•å®¹æ˜“äº§ç”Ÿæ­»é”ã€‚    WAITING ç­‰å¾…\nè¯¥çº¿ç¨‹ç”±å…¶ä»–çº¿ç¨‹çš„ notify æ¥å”¤é†’ã€‚\n  TIMED_WAITING æœ‰é™æ—¶é—´çš„ç­‰å¾…ã€‚\nåˆ°è¾¾ä¸€å®šæ—¶é—´åè‡ªæˆ‘å”¤é†’æˆ–è€…å—åˆ°ä»–äººå”¤é†’ã€‚\n  TERMINATED ç»ˆæ­¢\nrun() æ–¹æ³•æ‰§è¡Œå®Œæ¯• æˆ–è€… main æ–¹æ³•å®Œæˆä¹‹åï¼Œçº¿ç¨‹è¿›å…¥terminated çŠ¶æ€ã€‚\n    é”å¯¹è±¡\næ¯ä¸ªé”å¯¹è±¡éƒ½æœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯å°±ç»ªé˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯é˜»å¡é˜Ÿåˆ—ã€‚\n  wait/notify å†…å®¹è¡¥å……\n  wait() ä¼šé‡Šæ”¾é”\n  notify() ä¸é‡Šæ”¾é”\n  sleep() ä¸é‡Šæ”¾é”\n  wait() ä¹‹åçš„çº¿ç¨‹ï¼Œå¯ä»¥è¢« interrupt() æ‰“æ–­ï¼Œå¹¶ä¸”é‡Šæ”¾é”ã€‚\n  é€šçŸ¥è¿‡æ—©\nè‹¥é€šçŸ¥è¿‡æ—©ï¼Œä¼šæ‰“ä¹±ç¨‹åºè¿è¡Œé€»è¾‘ã€‚\npublic class MyRun { private String lock = new String(\u0026#34;\u0026#34;); public Runnable runnableA = new Runnable() { @Override public void run() { try{ synchronized (lock){ System.out.println(\u0026#34;Start wait\u0026#34;); lock.wait(); System.out.println(\u0026#34;End wait\u0026#34;); } }catch (Exception e){ } } }; public Runnable runnableB = new Runnable() { @Override public void run() { synchronized (lock){ System.out.println(\u0026#34;Start notify\u0026#34;); lock.notify(); System.out.println(\u0026#34;End notify\u0026#34;); } } }; } è¿‡æ—©é€šçŸ¥å¦‚ä¸‹\npublic static void main(String[] args) { MyRun run = new MyRun(); Thread B = new Thread(run.runnableB); B.setName(\u0026#34;B\u0026#34;); Thread A = new Thread(run.runnableA); A.setName(\u0026#34;A\u0026#34;); B.start(); //å…ˆé€šçŸ¥  A.start(); //å†ç­‰å¾… } æ­£å¸¸é¡ºåºå¯åŠ¨\npublic static void main(String[] args) { MyRun run = new MyRun(); Thread B = new Thread(run.runnableB); B.setName(\u0026#34;B\u0026#34;); Thread A = new Thread(run.runnableA); A.setName(\u0026#34;A\u0026#34;); A.start(); //å…ˆç­‰å¾…  B.start(); //å†é€šçŸ¥ }   wait çš„æ¡ä»¶å‘ç”Ÿå˜åŒ–ä¼šå¯¼è‡´ç¨‹åºé€»è¾‘çš„æ··ä¹±\n  å°ç»“     wait() ä¸ Thread.sleep()çš„åŒºåˆ« wait() ä¼šé‡Šæ”¾åŒæ­¥é”ï¼Œè€ŒThread.sleep() ä¸ä¼šé‡Šæ”¾é”ã€‚    "},{"id":9,"href":"/3.%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/","title":"3.çº¿ç¨‹é—´é€šä¿¡","parent":"ç®€ä»‹","content":" wait/notify ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼ ç®¡é“æµ PipedOutputStream, PipedInputStream join ThreadLocal  "},{"id":10,"href":"/2.%E5%AF%B9%E8%B1%A1%E5%8F%8A%E5%8F%98%E9%87%8F%E7%9A%84%E5%B9%B6%E5%8F%91%E8%AE%BF%E9%97%AE/2.3%E5%85%B6%E5%AE%83%E6%96%B9%E6%B3%95/","title":"2.3å…¶å®ƒæ–¹æ³•","parent":"2.å¯¹è±¡åŠå˜é‡çš„å¹¶å‘è®¿é—®","content":"1. volatile å…³é”®å­—    ä¸ºäº†å®ç°å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹é—´å¯è§ã€‚ä½¿å¾—çº¿ç¨‹ä»å…¬å…±å †æ ˆä¸­è·å–å˜é‡ï¼Œè€Œä¸æ˜¯çº¿ç¨‹ç§æœ‰æ•°æ®æ ˆã€‚\nJVM åœ¨ -sever æ¨¡å¼æ—¶ä¸ºäº†çº¿ç¨‹è¿è¡Œæ•ˆç‡ï¼Œçº¿ç¨‹ä¸€ç›´åœ¨ç§æœ‰å †æ ˆä¸­è·å–å˜é‡å€¼ï¼Œè€Œä¸»çº¿ç¨‹çš„å˜é‡æ˜¯å­˜å‚¨åœ¨å…¬å…±å †æ ˆä¸­ï¼Œè§£å†³è¿™ç§å¯è§æ€§é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ volatile ã€‚\nvolatile ä¸ synchronized çš„æ¯”è¾ƒï¼š\n  volatile ä¿è¯å¯è§æ€§ä½†ä¸ä¿è¯åŸå­æ€§ï¼ˆè‡´å‘½ç¼ºç‚¹ï¼‰ï¼Œsynchronized ä¿è¯åŸå­æ€§ä½†ä¸ä¿è¯å¯è§æ€§ã€‚\n  volatile åªèƒ½ä¿®é¥°å˜é‡ã€‚\n  volatile ä¸å‘ç”Ÿé˜»å¡ï¼Œsynchronized ä¼šé˜»å¡ã€‚\n  2. åŸå­ç±»    å¤šçº¿ç¨‹ä½¿ç”¨åŸå­æ“ä½œè®¿é—®å…±äº«èµ„æºæ—¶ï¼Œä¸éœ€è¦é”ä¹Ÿå¯ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ˆå¤šçº¿ç¨‹è®¿é—®åŒä¸€èµ„æºæ—¶ï¼Œä¸ä¼šå‡ºç°è„è¯»æˆ–å†™å¤±è´¥ï¼‰ã€‚\nä»¥ä¸‹ä»£ç ï¼Œå¤šä¸ªçº¿ç¨‹ç«äº‰åœ°è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ä¸­çš„ count ï¼Œ ä½¿ç”¨åŸå­æ“ä½œä¿è¯äº†çº¿ç¨‹å®‰å…¨ã€‚\n  CountService.java\npublic class CountService extends Thread{ private AtomicInteger count = new AtomicInteger(0);//åŸå­ç±»  @Override public void run(){ for (int i = 0; i \u0026lt; 1000; i++){ System.out.println(Thread.currentThread().getName() + \u0026#34;:\u0026#34; +count.incrementAndGet());//incrementAndGet æ–¹æ³•æ˜¯åŸå­æ“ä½œ  } } }   Run.java\npublic class Run { public static void main(String[] args) { CountService countService = new CountService(); Thread t1 = new Thread(countService); t1.setName(\u0026#34;t1\u0026#34;); t1.start(); Thread t2 = new Thread(countService); t2.setName(\u0026#34;t2\u0026#34;); t2.start(); Thread t3 = new Thread(countService); t3.setName(\u0026#34;t3\u0026#34;); t3.start(); } }   æ–¹æ³•é—´çš„è°ƒç”¨ä¸æ˜¯åŸå­çš„ï¼ˆè°ƒç”¨å¤šä¸ªåŸå­æ“ä½œï¼Œä¸å…·æœ‰åŸå­æ€§ï¼Œçº¿ç¨‹é—´ä¼šå‡ºç°æŠ¢å ï¼‰ï¼Œéœ€è¦ä½¿ç”¨ synchronized æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚\n"},{"id":11,"href":"/2.%E5%AF%B9%E8%B1%A1%E5%8F%8A%E5%8F%98%E9%87%8F%E7%9A%84%E5%B9%B6%E5%8F%91%E8%AE%BF%E9%97%AE/2.2%E5%90%8C%E6%AD%A5%E4%B8%AD%E7%9A%84%E6%97%A0%E9%99%90%E7%AD%89%E5%BE%85/","title":"2.2åŒæ­¥ä¸­çš„æ— é™ç­‰å¾…","parent":"2.å¯¹è±¡åŠå˜é‡çš„å¹¶å‘è®¿é—®","content":"1.é™æ€åŒæ­¥ä¸ synchronized(class)    é™æ€åŒæ­¥é”å®šçš„æ˜¯ç±»ã€‚\n  å¤šä¸ªå¯¹è±¡å…±ç”¨ä¸€æŠŠé”\nåŒä¸€ä¸ªç±»å¦‚æœä½¿ç”¨å¸¸é‡å­—ç¬¦ï¼ˆå¸¸é‡å­—ç¬¦ä¸²æ˜¯å­˜æ”¾åœ¨ç¼“å­˜ä¸­ï¼‰ä¸²ä½œä¸º synchronized(string) å¯¹è±¡ç›‘è§†å™¨ï¼Œå¹¶ä¸”å¯¹è±¡ A çš„åŒæ­¥æ–¹æ³•ä¸­æœ‰æ­»å¾ªç¯ï¼Œé‚£ä¹ˆå…¶ä»–å¯¹è±¡æ— æ³•è°ƒç”¨è¯¥åŒæ­¥æ–¹æ³•ï¼Œè¡¨ç°ä¸ºæ— é™ç­‰å¾…ï¼ˆå…¶ä»–çº¿ç¨‹è¢«é”ä½ï¼‰ã€‚\n  ä¸€ä¸ªå¯¹è±¡ä¸€æŠŠé”\nä½¿ç”¨å±€éƒ¨å˜é‡çš„æ–¹å¼å¯ä»¥é¿å…é”ä½å…¶ä»–çº¿ç¨‹ã€‚\n  2. synchronized æ— é™ç­‰å¾…    å› ä¸º synchronized é”å®šçš„æ˜¯å¯¹è±¡ï¼ŒåŒä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•åŒæ­¥æ‰§è¡Œï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒæŸä¸ªæ–¹æ³•å­˜åœ¨æ­»å¾ªç¯æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé™·å…¥æ— é™ç­‰å¾…ã€‚å¦‚ä¸‹ï¼Œthread ä¸ threadB å…±ç”¨ä¸€ä¸ª service ã€‚\npublic class Service { synchronized public void service1(){ System.out.println(\u0026#34;service1\u0026#34;); while (true){ System.out.println(\u0026#34;ha\u0026#34;); } } synchronized public void service2(){ System.out.println(\u0026#34;service2\u0026#34;); } } public class MyThread extends Thread{ Service service; public MyThread(Service service){ this.service = service; } @Override public void run(){ super.run(); service.service1(); } } public class MyThreadB extends Thread{ Service service; public MyThreadB(Service service){ this.service = service; } @Override public void run(){ super.run(); service.service2(); } } public class Run { public static void main(String[] args) { Service service = new Service();//two threads use the same service.  MyThread myThread = new MyThread(service); myThread.start(); MyThreadB myThreadB = new MyThreadB(service); myThreadB.start(); } } è§£å†³æ–¹æ³•ï¼šåŒæ­¥å—å¹¶ä¸”å¯¹è±¡ç›‘è§†å™¨ä½¿ç”¨ä¸åŒå¯¹è±¡ã€‚ä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªå¯¹è±¡ç›‘è§†å™¨ï¼Œåšåˆ°å•ä¸ªæ–¹æ³•çš„åŒæ­¥ï¼ˆé”ä½å•ä¸ªæ–¹æ³•ï¼‰ã€‚\npublic class Service { Object object = new Object(); public void service1(){ synchronized(object){ System.out.println(\u0026#34;service1\u0026#34;); while (true){ System.out.println(\u0026#34;ha\u0026#34;); } } } Object object1 = new Object(); public void service2(){ synchronized (object1){ System.out.println(\u0026#34;service2\u0026#34;); } } } 3. å¤šçº¿ç¨‹æ­»é”    æ­»é”æ¡ä»¶ï¼š\n äº’æ–¥(ä¸€ä»½èµ„æºåŒæ—¶åªèƒ½ä¾›ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨) å æœ‰ä¸”ç­‰å¾… ä¸å¯æŠ¢å  å¾ªç¯ç­‰å¾…  ä»¥ä¸‹ä¸¾ä¾‹äº† 4 ç§’é’Ÿçš„æ­»é”ï¼Œçº¿ç¨‹å æœ‰çš„æ—¶é—´è¶Šé•¿ï¼Œæ­»é”æ—¶é—´è¶Šé•¿ã€‚\npublic class DealThread implements Runnable{ public String username; public Object lock1 = new Object(); public Object lock2 = new Object(); public void setFlag(String username){ this.username = username; } @Override public void run(){ if (username.equals(\u0026#34;a\u0026#34;)){ synchronized (lock1){ System.out.println(\u0026#34;username: \u0026#34; + username); try{ Thread.sleep(4000);//4 second dead lock  }catch(Exception e){ e.printStackTrace(); } } synchronized (lock2){ System.out.println(\u0026#34;lock2 username: \u0026#34; + username); } }else if(username.equals(\u0026#34;b\u0026#34;)){ synchronized (lock2){ System.out.println(\u0026#34;username: \u0026#34; + username); try{ Thread.sleep(4000);//4 second dead lock  }catch(Exception e){ e.printStackTrace(); } } synchronized (lock1){ System.out.println(\u0026#34;lock1 username: \u0026#34; + username); } } } } "},{"id":12,"href":"/2.%E5%AF%B9%E8%B1%A1%E5%8F%8A%E5%8F%98%E9%87%8F%E7%9A%84%E5%B9%B6%E5%8F%91%E8%AE%BF%E9%97%AE/2.1%E5%90%8C%E6%AD%A5/","title":"2.1åŒæ­¥","parent":"2.å¯¹è±¡åŠå˜é‡çš„å¹¶å‘è®¿é—®","content":"1. å•ä¾‹æ¨¡å¼ä¸‹å¹¶å‘è®¿é—®åŒä¸€ä¸ªå¯¹è±¡çš„å†…å®¹    synchnized åŒæ­¥é”ï¼Œä½¿å¾—è°ƒç”¨æ–¹æ³•å˜æˆåŒæ­¥è®¿é—®å¯¹è±¡å±æ€§ã€‚\n2.å¤šä¸ªå¯¹è±¡å¤šæŠŠé”    æ–¹æ³•å¸¦æœ‰ synchronized åˆ™ä¸€ä¸ªå¯¹è±¡å¸¦æœ‰ä¸€æŠŠé”ï¼Œå¤šä¸ªå¯¹è±¡åœ¨ JVM ä¸­æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥å¤šä¸ªå¯¹è±¡çš„å¤šæŠŠé”è¡¨ç°ä¸ºå¼‚æ­¥çš„ã€‚\n3. è„è¯»    setValue() æ—¶ï¼Œä¸­é€”è¿›è¡Œ getValue() ï¼Œå¦‚æœ getValue() æ²¡æœ‰åŒæ­¥åˆ™å¯èƒ½å‡ºç°è„è¯»ã€‚\nåŒæ­¥é”ä½œç”¨äºå¯¹è±¡ï¼ŒéåŒæ­¥æ–¹æ³•å¯ä»¥å¼‚æ­¥è°ƒç”¨ï¼ŒåŒä¸€å¯¹è±¡çš„å¤šä¸ªåŒæ­¥æ–¹æ³•æ˜¯åŒæ­¥è°ƒç”¨ã€‚\npublic class MyObject { private String userName = \u0026#34;A\u0026#34;; private String password = \u0026#34;AA\u0026#34;; synchronized public void setValue(String userName, String password){ this.userName = userName; try { Thread.sleep(3000);//delay cause the dirtyRead  }catch (Exception e){ } this.password = password; } public void getValue(){ System.out.println(this.userName + \u0026#34;,\u0026#34; + this.password); } } getValue() åŠ ä¸ŠåŒæ­¥ä¹‹åä¸ä¼šæœ‰è„è¯»\npublic class MyObject { private String userName = \u0026#34;A\u0026#34;; private String password = \u0026#34;AA\u0026#34;; synchronized public void setValue(String userName, String password){ this.userName = userName; try { Thread.sleep(3000);//delay cause the dirtyRead  }catch (Exception e){ } this.password = password; } //Add synchronized  synchronized public void getValue(){ System.out.println(this.userName + \u0026#34;,\u0026#34; + this.password); } } 4. synchronized é”çš„é‡å…¥    ä¸€ä¸ªçº¿ç¨‹è·å¾—æŸä¸ªå¯¹è±¡çš„é”ï¼Œå¯¹è±¡é”æœªé‡Šæ”¾æ—¶è¿˜æƒ³å†æ¬¡è·å¾—é”ï¼Œæ˜¯å¯ä»¥çš„ã€‚\nå¦‚æœé”ä¸å¯é‡å…¥ï¼Œä¼šé€ æˆæ­»é”ã€‚\nå­ç±»å¯ä»¥é€šè¿‡â€œå¯é‡å…¥é”â€è°ƒç”¨çˆ¶ç±»çš„åŒæ­¥æ–¹æ³•ã€‚\nå½“å‰çº¿ç¨‹å‡ºç°å¼‚å¸¸æ—¶ï¼Œé”è‡ªåŠ¨é‡Šæ”¾ã€‚\nåŒæ­¥ä¸å…·æœ‰ç»§æ‰¿æ€§ã€‚\n5. synchronized çš„å¼Šç«¯    è‹¥ A çº¿ç¨‹æ‰§è¡Œä»»åŠ¡èŠ±çš„æ—¶é—´è¾ƒé•¿ï¼Œé‚£ä¹ˆ B çº¿ç¨‹ä¼šç­‰å¾…è¾ƒé•¿æ—¶é—´ã€‚\n  å¯ä»¥ä½¿ç”¨åŒæ­¥å—çš„æ–¹æ³•æ¥è§£å†³ï¼ŒåŒæ­¥å—ä¹Ÿæ˜¯é”å®šå¯¹è±¡ã€‚\nsynchronized(this){ this.data = data; } åªåŒæ­¥å…±ç”¨çš„éƒ¨åˆ†ã€‚\n  å°ç»“     æ¯ä¸ªå¯¹è±¡éƒ½å…·æœ‰é”æ€§è´¨ã€‚ synchronized é»˜è®¤é”ä½çš„æ˜¯å¯¹è±¡ synchronized(object) æ˜¯ä½¿ç”¨å¯¹è±¡ç›‘è§†å™¨æ¥å®ç°åŒæ­¥ï¼Œä½¿ç”¨çš„é”æ˜¯ object çš„é”ã€‚ é”æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸ä¸€ä¸ªåŒæ­¥ç›‘è§†å™¨ï¼ˆé”å¯¹è±¡ï¼‰ä¹‹é—´çš„å…³ç³»ï¼Œå¯¹è±¡è‡ªå·±ä½œä¸ºé”æ—¶ã€synchronized(this)ã€ï¼Œè‡ªå·±çº¿ç¨‹å¯¹é”ï¼ˆè‡ªèº«ï¼‰çš„è®¿é—®ä¹Ÿæ¶‰åŠé”ã€‚ä¸åŒçº¿ç¨‹é—´ä¸åŠ  synchronized åˆ™è®¤ä¸ºæ˜¯å¼‚æ­¥è°ƒç”¨ã€‚  "},{"id":13,"href":"/2.%E5%AF%B9%E8%B1%A1%E5%8F%8A%E5%8F%98%E9%87%8F%E7%9A%84%E5%B9%B6%E5%8F%91%E8%AE%BF%E9%97%AE/","title":"2.å¯¹è±¡åŠå˜é‡çš„å¹¶å‘è®¿é—®","parent":"ç®€ä»‹","content":"åŒæ­¥ synchronizedï¼Œå¼‚æ­¥ asynchronizedã€‚\nèµ„æºå…±äº«æ‰éœ€è¦åŒæ­¥ã€‚\nè¢«é”ä½çš„å˜é‡ç§°ä¸ºäº’æ–¥åŒºæˆ–ä¸´ç•ŒåŒºã€‚\næŒæœ‰ç›¸åŒçš„é”å¯¹è±¡ç›‘è§†å™¨åˆ™åŒæ­¥ï¼Œåˆ†åˆ«æŒæœ‰é”å¯¹è±¡ç›‘è§†å™¨åˆ™å¼‚æ­¥ã€‚\n"},{"id":14,"href":"/1.%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%BD%BF%E7%94%A8/1.2%E7%BA%BF%E7%A8%8B%E6%8E%A7%E5%88%B6/","title":"1.2çº¿ç¨‹æ§åˆ¶","parent":"1.å¤šçº¿ç¨‹çš„ä½¿ç”¨","content":"åœæ­¢çº¿ç¨‹      this.interrupted() æµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»æ˜¯ä¸­æ–­çŠ¶æ€ï¼Œæ‰§è¡ŒåæŠŠæ ‡å¿—ä½è®¾ç½®ä¸º false ã€‚\n  this.isInterrupted() æµ‹è¯•çº¿ç¨‹ Thread æ˜¯å¦å·²ç»ä¸­æ–­ï¼Œä½†ä¸æ¸…é™¤æ ‡å¿—ä½ã€‚\n  thread.interrupt()ï¼Œrun æ–¹æ³•ä¸­æœ‰sleepï¼Œä½¿ç”¨tryçš„ catchå¯ä»¥æ•æ‰åˆ° InterruptedExceptionã€‚\n  å¼‚å¸¸æ³•åœæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼ŒæŠ›å‡º InterruptedException ã€‚ï¼ˆæ¨èï¼‰\n  thread.stop() æš´åŠ›åœæ­¢ï¼Œä¸æ¨èã€‚\n  ä½¿ç”¨ return åœæ­¢çº¿ç¨‹ã€‚\n  æš‚åœçº¿ç¨‹     suspend ä¸resume å®ƒä»¬çš„ç¼ºé™·ï¼šç‹¬å ï¼ˆä¸åŒæ­¥ï¼‰ã€‚å¦‚æœå­çº¿ç¨‹ä¸­æœ‰è°ƒç”¨ synchronized æ–¹æ³•ï¼Œå°†å¯¼è‡´åŒæ­¥é”å¯èƒ½æœªè¢«é‡Šæ”¾ï¼Œåœ¨ä¸»çº¿ç¨‹è°ƒç”¨ç›¸åŒ synchronized æ–¹æ³•æ—¶æ— æ³•è·å¾—é”ï¼Œç¨‹åºå¡ä½ã€‚  yield æ–¹æ³•    äº¤å‡ºæ§åˆ¶æƒ\nthread.yield()\næ”¾å¼ƒå½“å‰ CPU èµ„æºï¼Œè®©ç»™å…¶ä»–ä»»åŠ¡å»å ç”¨ã€‚ï¼ˆä½†æ”¾å¼ƒçš„æ—¶é—´ä¸ç¡®å®šï¼Œå¯èƒ½å¾ˆçŸ­ï¼‰\nç‰ºç‰²è‡ªæˆ‘ï¼Œæˆå°±ä»–äººã€‚\nçº¿ç¨‹ä¼˜å…ˆçº§    A è°ƒç”¨ B ï¼Œåˆ™é»˜è®¤çš„ï¼Œ B çš„ä¼˜å…ˆçº§ä¸ A ä¸€è‡´ã€‚\n è§„åˆ™æ€§ï¼ŒæŒ‰ä¼˜å…ˆçº§çš„é«˜ä½æ¥åˆ†é… CPU èµ„æºï¼Œä¼˜å…ˆçº§ 1-10 é€æ¬¡å¢é«˜ã€‚ éšæœºæ€§ï¼Œä¼˜å…ˆçº§é«˜çš„ä¸ä¸€å®šå…ˆæ‰§è¡Œå®Œï¼Œä¼˜å…ˆçº§é«˜åªæ˜¯ä¿è¯ä¼šè¢«å°½é‡å¤šåœ°åˆ†é…è¿è¡Œèµ„æºã€‚  thread.setPriority(6);//è®¾ç½®ä¼˜å…ˆçº§ å®ˆæŠ¤çº¿ç¨‹    çº¿ç¨‹åˆ†ä¸ºï¼šç”¨æˆ·çº¿ç¨‹ã€å®ˆæŠ¤çº¿ç¨‹ã€‚\nGC å³æ˜¯å®ˆæŠ¤çº¿ç¨‹çš„ä¸€ç§ã€‚\nå½“å‰ JVM å®ä¾‹ä¸­ï¼Œæœ€åä¸€ä¸ª éå®ˆæŠ¤çº¿ç¨‹ï¼ˆç”¨æˆ·çº¿ç¨‹ï¼‰ ç»“æŸäº†ï¼Œå®ˆæŠ¤çº¿ç¨‹æ‰ç»“æŸã€‚\nthread.setDeamon(true);//å°† thread è®¾å®šä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚ "},{"id":15,"href":"/1.%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%BD%BF%E7%94%A8/","title":"1.å¤šçº¿ç¨‹çš„ä½¿ç”¨","parent":"ç®€ä»‹","content":""},{"id":16,"href":"/blog/","title":"Blog","parent":"ç®€ä»‹","content":""},{"id":17,"href":"/blog/life/","title":"Life","parent":"Blog","content":"å…³äº Hugo GeekDoc     GitHub å…ˆæ–°å»ºä¸€ä¸ªä»“åº“ï¼Œå¹¶é…ç½® Github Pagesã€‚ ä¸‹è½½ geekdoc çš„ releaseï¼Œæ”¾åˆ° theme æ–‡ä»¶å¤¹ä¸‹ã€‚ é…ç½®config.toml baseURL = \u0026#39;http://example.org/\u0026#39; languageCode = \u0026#39;en-us\u0026#39; title = \u0026#39;æŠ€æœ¯å­¦ä¹ ç¬”è®°\u0026#39; theme = \u0026#34;hugo-geekdoc\u0026#34; # Match the github rule. publishdir = \u0026#34;./docs/\u0026#34; pluralizeListTitles = false # Geekdoc required configuration pygmentsUseClasses = true pygmentsCodeFences = true disablePathToLower = true # Needed for mermaid shortcodes [markup] [markup.goldmark.renderer] # Needed for mermaid shortcode unsafe = true [markup.tableOfContents] startLevel = 1 endLevel = 9 [taxonomies] tag = \u0026#34;tags\u0026#34;  å¼€å§‹å†™æ–‡ç«  hugo new blog/life.md  æµ‹è¯• hugo server -D  ç”Ÿæˆ HTML hugo -D   Hugo ä½¿ç”¨æ–¹æ³•      æç¤ºæ¿ æç¤ºæ¿\nè¿™æ˜¯ hint ok\n æç¤ºæ¿\nè¿™æ˜¯ hint info\n æç¤ºæ¿\nè¿™æ˜¯ hint warn\n æç¤ºæ¿\nè¿™æ˜¯ hint danger\n æç¤ºæ¿\nè¿™æ˜¯ hint\n   å¯¼èˆªæ \n ç›®å½•åªå…è®¸åœ¨ content ä¸‹å¤šåŠ ä¸€å±‚ã€‚    åœ¨å­¦æ ¡    ç ”ä¸€9æœˆ      åˆ°æ ¡å å·¥ä½å•¦\næŠŠæ€æ˜Šå›èµ äºˆçš„æ˜¾ç¤ºå™¨æ‘†ä¸Šäº†æˆ‘çš„å·¥ä½ï¼Œæ¡Œæ¿ä¸Šæœ‰ä¸ªæ´å’Œæ˜¾ç¤ºå™¨æ”¯æ¶çš„è„šåˆšå¥½å¥‘åˆï¼Œå¯ä»¥æŠŠæ˜¾ç¤ºå™¨ç«–èµ·æ¥ï¼Œç«–å±å³åˆ»ä½“éªŒæ‹‰æ»¡ã€‚   èˆå‹çš„ C++ æµ·æŠ¥\nC++ çš„æ¡†æ¶å°½æ˜¾çœ¼å‰   "},{"id":18,"href":"/1.%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%BD%BF%E7%94%A8/1.1%E6%96%B0%E5%BB%BA%E7%BA%BF%E7%A8%8B/","title":"1.1çº¿ç¨‹æ–°å»º","parent":"1.å¤šçº¿ç¨‹çš„ä½¿ç”¨","content":"ä»¥ Thread å®ä¾‹çš„æ–¹å¼    Mythread.java\npackage threadTest; public class MyThread extends Thread{ @Override public void run(){ super.run(); for (int i = 0; i \u0026lt; 100; i++){ System.out.println(\u0026#34;MyThread:\u0026#34; + i); } } } Main.java\npackage threadTest; public class main { public static void main(String[] args){ MyThread myThread = new MyThread(); myThread.start(); MyThread myThread1 = new MyThread(); myThread1.start(); System.out.println(\u0026#34;Has been ran\u0026#34;); } } ä»¥åŒ…è£… Runnable çš„æ–¹å¼    å› ä¸º Runnable æ¥å£ä¸­åªæœ‰ run æ–¹æ³•ï¼Œæ— æ³•å¯åŠ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚æ‰€ä»¥å€Ÿç”± Thread çš„æ„é€ ï¼Œå¯ä»¥æ–°å»ºçº¿ç¨‹ã€‚\nRunnable.java\npackage threadTest; public class MyRunnable implements Runnable{ @Override public void run(){ System.out.println(\u0026#34;Runnable\u0026#34;); } } Run.java\npackage threadTest; public class Run { public static void main(String[] args) { Runnable runnable = new MyRunnable(); Thread thread = new Thread(runnable); //runnable has no \u0026#39;start\u0026#39; method, so use thread to decorate(compact).  thread.start(); System.out.println(\u0026#34;done\u0026#34;); } } start() ä¸ run() çš„åŒºåˆ«      è°ƒç”¨ start() æ˜¯é€šçŸ¥çº¿ç¨‹è§„åˆ’å™¨ï¼Œç›®æ ‡çº¿ç¨‹å·²ç»å‡†å¤‡å¥½äº†ï¼Œçº¿ç¨‹è§„åˆ’å™¨å¯ä»¥å®‰æ’ä¸€ä¸ªæ—¶é—´æ¥å¯åŠ¨ç›®æ ‡çº¿ç¨‹ï¼Œå±äºå¼‚æ­¥æ‰§è¡Œã€‚\n  è°ƒç”¨ run() æ—¶ï¼Œæ˜¯ç›´æ¥æ‰§è¡Œå¯¹åº”çš„ç›®æ ‡çº¿ç¨‹çš„ä»£ç æ®µï¼Œæ‰§è¡Œå®Œ run() ä¸­çš„ä»£ç æ‰ä¼šç»§ç»­ä¸‹ä¸€æ­¥ï¼Œå±äºåŒæ­¥æ‰§è¡Œã€‚\n  "},{"id":19,"href":"/","title":"ç®€ä»‹","parent":"","content":"å…³äº Blogï¼šå­¦ä¹ å¿ƒå¾—çš„è®°å½•ã€å­¦ä¹ ç¬”è®°ã€‚    "},{"id":20,"href":"/tags/","title":"Tags","parent":"ç®€ä»‹","content":""}]